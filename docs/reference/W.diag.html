<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Wadsworth's univariate and bivariate exponential threshold diagnostics — W.diag • mev</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wadsworth's univariate and bivariate exponential threshold diagnostics — W.diag"><meta name="description" content="Function to produce diagnostic plots and test statistics for the
threshold diagnostics exploiting structure of maximum likelihood estimators
based on the non-homogeneous Poisson process likelihood"><meta property="og:description" content="Function to produce diagnostic plots and test statistics for the
threshold diagnostics exploiting structure of maximum likelihood estimators
based on the non-homogeneous Poisson process likelihood"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.10007</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/01-univariate.html">Likelihood based inference for univariate extremes</a></li>
    <li><a class="dropdown-item" href="../articles/02-threshold.html">Threshold selection</a></li>
    <li><a class="dropdown-item" href="../articles/03-penultimate.html">Penultimate approximations</a></li>
    <li><a class="dropdown-item" href="../articles/04-simulation.html">Simulation of multivariate extreme value distributions and processes</a></li>
    <li><a class="dropdown-item" href="../articles/mev-vignette.html">Exact unconditional sampling from max-stable random vectors</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lbelzile/mev/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Wadsworth's univariate and bivariate exponential threshold diagnostics</h1>
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/mev/blob/HEAD/R/Wdiag.R" class="external-link"><code>R/Wdiag.R</code></a></small>
      <div class="d-none name"><code>W.diag.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to produce diagnostic plots and test statistics for the
threshold diagnostics exploiting structure of maximum likelihood estimators
based on the non-homogeneous Poisson process likelihood</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">W.diag</span><span class="op">(</span></span>
<span>  <span class="va">xdat</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nhpp"</span>, <span class="st">"exp"</span>, <span class="st">"invexp"</span><span class="op">)</span>,</span>
<span>  u <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">k</span>,</span>
<span>  q1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  q2 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  par <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  M <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nbs <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LRT"</span>, <span class="st">"WN"</span>, <span class="st">"PS"</span><span class="op">)</span>,</span>
<span>  UseQuantiles <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  changepar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-xdat">xdat<a class="anchor" aria-label="anchor" href="#arg-xdat"></a></dt>
<dd><p>a numeric vector of data to be fitted.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>string specifying whether the univariate or bivariate diagnostic should be used. Either <code>nhpp</code>
for the univariate model, <code>exp</code> (<code>invexp</code>) for the bivariate exponential model with rate (inverse rate) parametrization. See details.</p></dd>


<dt id="arg-u">u<a class="anchor" aria-label="anchor" href="#arg-u"></a></dt>
<dd><p>optional; vector of candidate thresholds.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>number of thresholds to consider (if <code>u</code> unspecified).</p></dd>


<dt id="arg-q-">q1<a class="anchor" aria-label="anchor" href="#arg-q-"></a></dt>
<dd><p>lowest quantile for the threshold sequence.</p></dd>


<dt id="arg-q-">q2<a class="anchor" aria-label="anchor" href="#arg-q-"></a></dt>
<dd><p>upper quantile limit for the threshold sequence (<code>q2</code> itself is not used as a threshold,
but rather the uppermost threshold will be at the \((q_2-1/k): q2-1/k\) quantile).</p></dd>


<dt id="arg-par">par<a class="anchor" aria-label="anchor" href="#arg-par"></a></dt>
<dd><p>parameters of the NHPP likelihood. If <code>missing</code>, the <code><a href="fit.pp.html">fit.pp</a></code> routine will be run to obtain values</p></dd>


<dt id="arg-m">M<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>number of superpositions or 'blocks' / 'years' the process corresponds to (can affect the optimization)</p></dd>


<dt id="arg-nbs">nbs<a class="anchor" aria-label="anchor" href="#arg-nbs"></a></dt>
<dd><p>number of simulations used to assess the null distribution of the LRT, and produce the p-value</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>significance level of the LRT</p></dd>


<dt id="arg-plots">plots<a class="anchor" aria-label="anchor" href="#arg-plots"></a></dt>
<dd><p>vector of strings indicating which plots to produce; <code>LRT</code>= likelihood ratio test, <code>WN</code> = white noise, <code>PS</code> = parameter stability. Use <code>NULL</code> if you do not want plots to be produced</p></dd>


<dt id="arg-usequantiles">UseQuantiles<a class="anchor" aria-label="anchor" href="#arg-usequantiles"></a></dt>
<dd><p>logical; use quantiles as the thresholds in the plot?</p></dd>


<dt id="arg-changepar">changepar<a class="anchor" aria-label="anchor" href="#arg-changepar"></a></dt>
<dd><p>logical; if <code>TRUE</code>, the graphical parameters (via a call to <code>par</code>) are modified.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional parameters passed to <code>plot</code>, overriding defaults including</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>plots of the requested diagnostics and an invisible list with components</p><ul><li><p><code>MLE</code>: maximum likelihood estimates from all thresholds</p></li>
<li><p><code>Cov</code>: joint asymptotic covariance matrix for \(\xi\), \(\eta\) or \(1/\eta\).</p></li>
<li><p><code>WN</code>: values of the white noise process</p></li>
<li><p><code>LRT</code>: values of the likelihood ratio test statistic vs threshold</p></li>
<li><p><code>pval</code>: <em>P</em>-value of the likelihood ratio test</p></li>
<li><p><code>k</code>: final number of thresholds used</p></li>
<li><p><code>thresh</code>: threshold selected by the likelihood ratio procedure</p></li>
<li><p><code>qthresh</code>: quantile level of threshold selected by the likelihood ratio procedure</p></li>
<li><p><code>thresh0</code>: vector of candidate thresholds</p></li>
<li><p><code>qthresh0</code>: quantile level of candidate thresholds</p></li>
<li><p><code>mle.u</code>: maximum likelihood estimates for the selected threshold</p></li>
<li><p><code>model</code>: model fitted</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function is a wrapper for the univariate (non-homogeneous Poisson process model) and bivariate exponential dependence model.
For the latter, the user can select either the rate or inverse rate parameter  (the inverse rate parametrization  works better for uniformity
of the p-value distribution under the <code>LR</code> test.</p>
<p>There are two options for the bivariate diagnostic: either provide pairwise minimum of marginally
exponentially distributed margins or provide a <code>n</code> times 2 matrix with the original data, which
is transformed to exponential margins using the empirical distribution function.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wadsworth, J.L. (2016). Exploiting Structure of Maximum Likelihood Estimators for Extreme Value Threshold Selection, <em>Technometrics</em>, <b>58</b>(1), 116-126, <code>http://dx.doi.org/10.1080/00401706.2014.998345</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jennifer L. Wadsworth</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Parameter stability only</span></span></span>
<span class="r-in"><span><span class="fu">W.diag</span><span class="op">(</span>xdat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">'nhpp'</span>,</span></span>
<span class="r-in"><span>       k <span class="op">=</span> <span class="fl">30</span>, q1 <span class="op">=</span> <span class="fl">0</span>, plots <span class="op">=</span> <span class="st">"PS"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">W.diag</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">'nhpp'</span>, k <span class="op">=</span> <span class="fl">20</span>, q1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xbvn</span> <span class="op">&lt;-</span> <span class="fu"><a href="mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6000</span>,</span></span>
<span class="r-in"><span>                mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Transform margins to exponential manually</span></span></span>
<span class="r-in"><span><span class="va">xbvn.exp</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">xbvn</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#rate parametrization</span></span></span>
<span class="r-in"><span><span class="fu">W.diag</span><span class="op">(</span>xdat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">xbvn.exp</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">'exp'</span>,</span></span>
<span class="r-in"><span>       k <span class="op">=</span> <span class="fl">30</span>, q1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">W.diag</span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">xbvn</span>, model <span class="op">=</span> <span class="st">'exp'</span>, k <span class="op">=</span> <span class="fl">30</span>, q1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#inverse rate parametrization</span></span></span>
<span class="r-in"><span><span class="fu">W.diag</span><span class="op">(</span>xdat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">xbvn.exp</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">'invexp'</span>,</span></span>
<span class="r-in"><span>       k <span class="op">=</span> <span class="fl">30</span>, q1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Leo Belzile, Jennifer L. Wadsworth, Paul J. Northrop, Scott D. Grimshaw, Raphael Huser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

