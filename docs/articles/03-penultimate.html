<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mev">
<title>Penultimate approximations • mev</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Penultimate approximations">
<meta property="og:description" content="mev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.14</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-univariate.html">Likelihood based inference for univariate extremes</a>
    <a class="dropdown-item" href="../articles/02-threshold.html">Threshold selection</a>
    <a class="dropdown-item" href="../articles/03-penultimate.html">Penultimate approximations</a>
    <a class="dropdown-item" href="../articles/04-simulation.html">Simulation of multivariate extreme value distributions and processes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lbelzile/mev/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Penultimate approximations</h1>
                        <h4 data-toc-skip class="author">Léo
Belzile</h4>
            
            <h4 data-toc-skip class="date">2022-04-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/mev/blob/HEAD/vignettes/03-penultimate.Rmd" class="external-link"><code>vignettes/03-penultimate.Rmd</code></a></small>
      <div class="d-none name"><code>03-penultimate.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h2>
<p>The generalized extreme value (GEV) distribution arises as the
non-degenerate limiting distribution of maxima. A key property of the
generalized extreme value distribution is max-stability, meaning that
the distribution of maxima of <span class="math inline">\(T \in
\mathbb{N}\)</span> is the same up to a location-scale transform: if
<span class="math inline">\(F \sim \mathsf{GEV}\)</span>, then there
exist location and scale constants <span class="math inline">\(b \in
\mathbb{R}\)</span> and <span class="math inline">\(a&gt;0\)</span> such
that <span class="math inline">\(F^T(ax+b) = F(x)\)</span>. The
parameters of the new distribution are easily derived: if <span class="math inline">\(X_i \stackrel{\cdot}{\sim}
\mathsf{GEV}(\mu,\sigma, \xi)\)</span>, then <span class="math inline">\(\max\{X_1, \ldots, X_T\} \sim \mathsf{GEV}(\mu_T,
\sigma_T, \xi)\)</span> with <span class="math inline">\(\mu_T = \mu -
\sigma(1-T^\xi)/\xi\)</span> and <span class="math inline">\(\sigma_T =
\sigma T^\xi\)</span> for <span class="math inline">\(\xi \mathbb{N}eq
0\)</span>, or <span class="math inline">\(\mu_T = \mu +\sigma
\log(T)\)</span> and <span class="math inline">\(\sigma_T =
\sigma\)</span> if <span class="math inline">\(\xi=0\)</span>.</p>
<p>In practice, the GEV is fitted to data that are partitioned into
<span class="math inline">\(k\)</span> blocks of sizes <span class="math inline">\(m\)</span>, assumed eequal for simplicity, so that
<span class="math inline">\(n = km\)</span>. The quality of the
generalized extreme value approximation increases with the block size
<span class="math inline">\(m\)</span>. For fixed block sizes, the
estimated shape parameter generally differs from its asymptotic
counterpart and this discrepancy usually introduces bias if one
extrapolates far beyond the range of the observed data.</p>
<p>Let <span class="math inline">\(F(x)\)</span> denote a
thrice-differentiable distribution function with endpoint <span class="math inline">\(x^*\)</span> and density <span class="math inline">\(f(x)\)</span> and define <span class="math inline">\(s(x)=-F(x)\log\{F(x)\}/f(x)\)</span>. The
existence of the limit <span class="math inline">\(\xi_{\infty} =
\lim_{n \to \infty} s'\{b_n\}\)</span> is necessary and sufficient
for convergence to an extreme value distribution <span class="math inline">\(G\)</span>, <span class="math display">\[\begin{align*}
\lim_{n \to \infty} F^n(a_nx+b_n) = \exp\left\{-(1+\xi_\infty
x)^{-1/\xi_\infty}\right\}=G(x).
\end{align*}\]</span></p>
<p><span class="citation">Smith (1987)</span> shows that, for any <span class="math inline">\(x \in \{y:1+\xi_\infty y &gt;0\}\)</span>, there
exists <span class="math inline">\(z\)</span> such that <span class="math display">\[\begin{align*}
   \frac{-\log[F\{v+xs(v)\}]}{-\log\{F(v)\}} =
\left\{1+xs'(z)\right\}^{-1/s'(z)}, \qquad v &lt; z &lt;
v+xs(v).
\end{align*}\]</span> For each <span class="math inline">\(n \geq
1\)</span>, setting <span class="math inline">\(v=b_n\)</span> and <span class="math inline">\(a_n=s(b_n)\)</span> yields <span class="math display">\[\begin{align*}
   F^n(a_nx+b_n)=\exp\left[-\left\{1+s'(z)x\right\}^{-1/s'(z)}\right]
+ \mathrm{O}(n^{-1})
\end{align*}\]</span> for <span class="math inline">\(z \in
[\min(a_nx+b_n, b_n), \max(a_nx+b_n, b_n)]\)</span>, depending on the
support of <span class="math inline">\(F\)</span>. The ultimate
approximation replaces <span class="math inline">\(s'(z)\)</span> by
<span class="math inline">\(s'(x^*)=\xi_{\infty}\)</span>, whereas
<span class="citation">Smith (1987)</span> suggests instead suggests
taking <span class="math inline">\(s'(b_n)\)</span>, which is closer
to <span class="math inline">\(s'(a_nx+b_n)\)</span> than is <span class="math inline">\(s'(x^*)\)</span>.</p>
<p>The maximum likelihood estimate of the shape should change as the
threshold or the block size increases. Consider for simplicity yearly
maxima arising from blocking <span class="math inline">\(m=n_y\)</span>
observations per year. We are interested in the distribution of the
maximum of <span class="math inline">\(N\)</span> years and thus the
target has roughly shape <span class="math inline">\(\xi_{Nn_y}\)</span>, but our estimates will
instead give approximately <span class="math inline">\(\xi_{n_y}\)</span>; an extrapolation error arises
from this mismatch between the shape values, which would be constant if
the observations were truly max-stable. The curvature of <span class="math inline">\(s'\)</span> determines how stable the
estimates of <span class="math inline">\(\xi_t\)</span> are when the
extrapolation window increases.</p>
<p>We illustrate the previous discussion by looking at block maximum
from a log-normal distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lbelzile.github.io/mev/" class="external-link">mev</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">x</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>
<span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="fl">200</span>,
    <span class="fu"><a href="../reference/fit.gev.html">fit.gev</a></span><span class="op">(</span>
      xdat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>
        X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">30</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, 
               ncol <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, 
        MARGIN <span class="op">=</span> <span class="fl">1</span>, 
        FUN <span class="op">=</span> <span class="va">max</span><span class="op">)</span>,
      method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">est</span><span class="op">)</span><span class="op">)</span>
<span class="va">penult.bm.lnorm</span> <span class="op">&lt;-</span>
  <span class="fu">mev</span><span class="fu">::</span><span class="fu"><a href="../reference/smith.penult.html">smith.penult</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"bm"</span>,
                    m <span class="op">=</span> <span class="op">(</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">30</span><span class="op">)</span>,
                    family <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span>
  <span class="va">fitted</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>,
  probability <span class="op">=</span> <span class="cn">TRUE</span>,
  breaks <span class="op">=</span> <span class="fl">20</span>,
  xlab <span class="op">=</span> <span class="st">"estimated shape"</span>,
  main <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>
  y0 <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,
  y1 <span class="op">=</span> <span class="fl">0</span>,
  x0 <span class="op">=</span> <span class="va">penult.bm.lnorm</span><span class="op">$</span><span class="va">shape</span>,
  col <span class="op">=</span> <span class="st">"red"</span>,
  lwd <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>
  y0 <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,
  y1 <span class="op">=</span> <span class="fl">0</span>,
  x0 <span class="op">=</span> <span class="fl">0</span>,
  col <span class="op">=</span> <span class="st">"black"</span>,
  lwd <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>

<span class="va">p30</span> <span class="op">&lt;-</span> <span class="va">penult.bm.lnorm</span>
<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">N30</span> <span class="op">=</span> <span class="va">N</span> <span class="op">/</span> <span class="fl">30</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">N</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">plnorm</a></span><span class="op">(</span><span class="va">x</span>, log.p <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
  type <span class="op">=</span> <span class="st">"l"</span>,
  bty <span class="op">=</span> <span class="st">"l"</span>,
  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,
  xlab <span class="op">=</span> <span class="st">"x"</span>,
  ylab <span class="op">=</span> <span class="st">"density"</span>
<span class="op">)</span>
<span class="co"># Get parameters of maximum of N GEV</span>
<span class="va">maxstabp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">loc</span>, <span class="va">scale</span>, <span class="va">shape</span>, <span class="va">N</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">shape</span>, <span class="fl">0</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mut</span> <span class="op">&lt;-</span> <span class="va">loc</span> <span class="op">-</span> <span class="va">scale</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">N</span> <span class="op">^</span> <span class="va">shape</span><span class="op">)</span> <span class="op">/</span> <span class="va">shape</span>
    <span class="va">sigmat</span> <span class="op">=</span> <span class="va">scale</span> <span class="op">*</span> <span class="va">N</span> <span class="op">^</span> <span class="va">shape</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
      loc <span class="op">=</span> <span class="va">mut</span>,
      scale <span class="op">=</span> <span class="va">sigmat</span>,
      shape <span class="op">=</span> <span class="va">shape</span>
    <span class="op">)</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
    <span class="va">mut</span> <span class="op">&lt;-</span> <span class="va">loc</span> <span class="op">+</span> <span class="va">scale</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
      loc <span class="op">=</span> <span class="va">mut</span>,
      scale <span class="op">=</span> <span class="va">scale</span>,
      shape <span class="op">=</span> <span class="va">shape</span>
    <span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">p30e</span> <span class="op">&lt;-</span>
  <span class="fu">maxstabp</span><span class="op">(</span>
    loc <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">loc</span>,
    scale <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">scale</span>,
    shape <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">shape</span>,
    N <span class="op">=</span> <span class="va">N30</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gev.html" class="external-link">dgev</a></span><span class="op">(</span>
    <span class="va">x</span>,
    loc <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'loc'</span><span class="op">]</span>,
    scale <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'scale'</span><span class="op">]</span>,
    shape <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'shape'</span><span class="op">]</span>
  <span class="op">)</span>,
  col <span class="op">=</span> <span class="st">"red"</span>,
  lwd <span class="op">=</span> <span class="fl">2</span>,
  lty <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>
<span class="va">p30l</span> <span class="op">&lt;-</span>
  <span class="fu">maxstabp</span><span class="op">(</span>
    loc <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">loc</span>,
    scale <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">scale</span>,
    shape <span class="op">=</span> <span class="fl">0</span>,
    N <span class="op">=</span> <span class="va">N30</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gev.html" class="external-link">dgev</a></span><span class="op">(</span>
    <span class="va">x</span>,
    loc <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'loc'</span><span class="op">]</span>,
    scale <span class="op">=</span> <span class="va">p30l</span><span class="op">[</span><span class="st">'scale'</span><span class="op">]</span>,
    shape <span class="op">=</span> <span class="fl">0</span>
  <span class="op">)</span>,
  col <span class="op">=</span> <span class="fl">1</span>,
  lty <span class="op">=</span> <span class="fl">3</span>,
  lwd <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="st">"topright"</span>,
  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exact"</span>, <span class="st">"ultimate"</span>, <span class="st">"penultimate"</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
  lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,
  bty <span class="op">=</span> <span class="st">"n"</span>,
  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="03-penultimate_files/figure-html/penult-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>The left panel illustrates how maximum likelihood estimates of the
parameters for repeated samples from a log-normal distribution are
closer to the penultimate approximation than to the limiting tail index
<span class="math inline">\(\xi_{\infty}=0\)</span>. Using
max-stability, we could get an estimate of the distribution of the
maximum of <span class="math inline">\(Nn_y\)</span> observations. In
this case, the penultimate shape for <span class="math inline">\(m=1000\)</span> is approximately <span class="math inline">\(\xi_{1000}=0.215\)</span>, compared to <span class="math inline">\(\xi_{30} \approx 0.284\)</span>, which is far from
the limiting value <span class="math inline">\(\xi_{\infty}=0\)</span>.
The extrapolated density estimate is based on <span class="math inline">\(F_1^{1000/30}\)</span>, the generalized extreme
value density associated to the distribution function of the penultimate
approximation <span class="math inline">\(F_1^{1000/30}\)</span>, with
<span class="math inline">\(F_1 \sim\mathsf{GEV}(a_{30}, b_{30},
\xi_{30})\)</span>. The penultimate approximation <span class="math inline">\(F_2\)</span> is more accurate than the ultimate
approximation <span class="math inline">\(\mathsf{GEV}(a_{30}, b_{30},
\xi_\infty)\)</span>, which is too short tailed.</p>
<p>The function <code>smith.penult</code> computes the penultimate
approximation for parameter models in <strong>R</strong> for the
distribution assuming a model <code>family</code> with arguments
<code>dfamily</code>, <code>qfamily</code> and <code>pfamily</code>
exist. It returns the penultimate parameters for a given block size or
quantile in case of threshold models. These functions are particularly
useful for simulation studies in which one wants to obtain an
approximation for <span class="math inline">\(F^N\)</span> for large
<span class="math inline">\(N\)</span>, to get an approximation to the
asymptotic distribution of a test statistic for finite <span class="math inline">\(N\)</span>; the <span class="math inline">\(\mathsf{GEV}\)</span> penultimate approximation is
more numerically stable for certain models and its moments and cumulants
are easily derived.</p>
<p>The following plot illustrates the penultimate shape parameter for
the normal distribution based on threshold exceedances. In finite
samples, the upper tail is bounded, but the quality of the approximation
by the Gumbel distribution increases as <span class="math inline">\(u
\to \infty\)</span>, albeit very slowly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9999</span>, by <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span>
<span class="va">penult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smith.penult.html">smith.penult</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"norm"</span>,
                       method <span class="op">=</span> <span class="st">"pot"</span>,
                       u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>
  <span class="va">u</span>,
  <span class="va">penult</span><span class="op">$</span><span class="va">shape</span>,
  bty <span class="op">=</span> <span class="st">"l"</span>,
  type <span class="op">=</span> <span class="st">'l'</span>,
  xlab <span class="op">=</span> <span class="st">'quantile'</span>,
  ylab <span class="op">=</span> <span class="st">'penultimate shape'</span>
<span class="op">)</span></code></pre></div>
<p><img src="03-penultimate_files/figure-html/penultimateshape-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>While the above discussion has been restricted to block maxima and
the generalized extreme value distribution, similar results exists for
peaks over threshold using a generalized Pareto distribution. For
threshold exceedances, we start with the reciprocal hazard <span class="math inline">\(r(x) = \{1-F(x)\}/f(x)\)</span> in place of <span class="math inline">\(s(x)\)</span>. The normalizing constants are <span class="math inline">\((u, r(u))\)</span> and the penultimate shape
parameter for the generalized Pareto distribution is <span class="math inline">\(r'(u)\)</span>.</p>
<p>We can relate threshold exceedances to the distribution of maxima as
follows: suppose a generalized Pareto distribution <span class="math inline">\(F\)</span> is fitted to threshold exceedances
above a threshold <span class="math inline">\(u\)</span>, with
parameters <span class="math inline">\((\zeta_u, \sigma_u,
\xi)\)</span>, where <span class="math inline">\(\zeta_u\)</span>
denotes the unknown proportion of points above the threshold <span class="math inline">\(u\)</span>. If there are <span class="math inline">\(n_y\)</span> observations per year on average,
then the <span class="math inline">\(T\)</span>-year return level is
<span class="math inline">\(z_{1/T}=u+\sigma_u/\xi\{(Tn_y\zeta_u)^\xi-1\}\)</span>.
We take <span class="math inline">\(F^{\zeta_uTn_y}\)</span> as the
approximation to the <span class="math inline">\(T\)</span>-year maxima
distribution, conditional on exceeding <span class="math inline">\(u\)</span>.</p>
</div>
<div class="section level2">
<h2 id="exercice">Exercice<a class="anchor" aria-label="anchor" href="#exercice"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Sample observations from the standard Gaussian distribution <span class="math inline">\(\mathsf{No}(0,1)\)</span> for <span class="math inline">\(m = 25, 50, 100, 1000\)</span> and <span class="math inline">\(k=1000\)</span> replications.</li>
<li>Fit a generalized extreme value distribution to block maxima of size
<span class="math inline">\(m\)</span>. Obtain an estimate of the
distribution of <span class="math inline">\(m = 1000000\)</span>
observations from a standard Gaussian using max-stability (the functions
<code>fit.gev</code> and <code>gev.mle</code> can be useful).</li>
<li>Plot the density of the resulting approximations and compare them to
the density of the true distribution <span class="math inline">\(N\phi(x)\Phi^{N-1}(x)\)</span>.</li>
<li>Superpose the density of the penultimate approximation for <span class="math inline">\(m = 1000000\)</span> obtained using the Smith
penultimate approximation (<code>smith.penult</code>).</li>
</ol>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Smith:1987" class="csl-entry">
Smith, Richard L. 1987. <span>“Approximations in Extreme Value
Theory.”</span> Edited by University of North Carolina Chapel Hill
Center for Stochastic Processes.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leo Belzile, Jennifer L. Wadsworth, Paul J. Northrop,
Scott D. Grimshaw, Raphael Huser.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
