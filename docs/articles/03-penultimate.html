<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Penultimate approximations • mev</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Penultimate approximations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.10006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-univariate.html">Likelihood based inference for univariate extremes</a></li>
    <li><a class="dropdown-item" href="../articles/02-threshold.html">Threshold selection</a></li>
    <li><a class="dropdown-item" href="../articles/03-penultimate.html">Penultimate approximations</a></li>
    <li><a class="dropdown-item" href="../articles/04-simulation.html">Simulation of multivariate extreme value distributions and processes</a></li>
    <li><a class="dropdown-item" href="../articles/mev-vignette.html">Exact unconditional sampling from max-stable random vectors</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lbelzile/mev/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Penultimate approximations</h1>
                        <h4 data-toc-skip class="author">Léo
Belzile</h4>
            
            <h4 data-toc-skip class="date">2025-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/mev/blob/HEAD/vignettes/03-penultimate.Rmd" class="external-link"><code>vignettes/03-penultimate.Rmd</code></a></small>
      <div class="d-none name"><code>03-penultimate.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h2>
<p>The generalized extreme value (GEV) distribution arises as the
non-degenerate limiting distribution of maxima. A key property of the
generalized extreme value distribution is max-stability, meaning that
the distribution of maxima of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><mi>ℕ</mi></mrow><annotation encoding="application/x-tex">T \in \mathbb{N}</annotation></semantics></math>
is the same up to a location-scale transform: if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>∼</mo><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow></mrow><annotation encoding="application/x-tex">F \sim \mathsf{GEV}</annotation></semantics></math>,
then there exist location and scale constants
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>∈</mo><mi>ℝ</mi></mrow><annotation encoding="application/x-tex">b \in \mathbb{R}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a&gt;0</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mi>T</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F^T(ax+b) = F(x)</annotation></semantics></math>.
The parameters of the new distribution are easily derived: if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mover><mo>∼</mo><mo accent="false">⋅</mo></mover><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>,</mo><mi>σ</mi><mo>,</mo><mi>ξ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_i \stackrel{\cdot}{\sim} \mathsf{GEV}(\mu,\sigma, \xi)</annotation></semantics></math>,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>max</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>X</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>X</mi><mi>T</mi></msub><mo stretchy="false" form="postfix">}</mo><mo>∼</mo><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>T</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>T</mi></msub><mo>,</mo><mi>ξ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\max\{X_1, \ldots, X_T\}  \sim \mathsf{GEV}(\mu_T, \sigma_T, \xi)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>T</mi></msub><mo>=</mo><mi>μ</mi><mo>−</mo><mi>σ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msup><mi>T</mi><mi>ξ</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>ξ</mi></mrow><annotation encoding="application/x-tex">\mu_T = \mu - \sigma(1-T^\xi)/\xi</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>T</mi></msub><mo>=</mo><mi>σ</mi><msup><mi>T</mi><mi>ξ</mi></msup></mrow><annotation encoding="application/x-tex">\sigma_T = \sigma T^\xi</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mi>ℕ</mi><mi>e</mi><mi>q</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">\xi \mathbb{N}eq 0</annotation></semantics></math>,
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>T</mi></msub><mo>=</mo><mi>μ</mi><mo>+</mo><mi>σ</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_T = \mu +\sigma \log(T)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>T</mi></msub><mo>=</mo><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma_T = \sigma</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\xi=0</annotation></semantics></math>.</p>
<p>In practice, the GEV is fitted to data that are partitioned into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
blocks of sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>,
assumed eequal for simplicity, so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>k</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">n = km</annotation></semantics></math>.
The quality of the generalized extreme value approximation increases
with the block size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
For fixed block sizes, the estimated shape parameter generally differs
from its asymptotic counterpart and this discrepancy usually introduces
bias if one extrapolates far beyond the range of the observed data.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(x)</annotation></semantics></math>
denote a thrice-differentiable distribution function with endpoint
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>x</mi><mo>*</mo></msup><annotation encoding="application/x-tex">x^*</annotation></semantics></math>
and density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math>
and define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>−</mi><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><mo stretchy="false" form="prefix">{</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mi>/</mi><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(x)=-F(x)\log\{F(x)\}/f(x)</annotation></semantics></math>.
The existence of the limit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ξ</mi><mi>∞</mi></msub><mo>=</mo><msub><mo>lim</mo><mrow><mi>n</mi><mo>→</mo><mi>∞</mi></mrow></msub><mi>s</mi><mi>′</mi><mo stretchy="false" form="prefix">{</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\xi_{\infty} =  \lim_{n \to \infty} s'\{b_n\}</annotation></semantics></math>
is necessary and sufficient for convergence to an extreme value
distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munder><mo>lim</mo><mrow><mi>n</mi><mo>→</mo><mi>∞</mi></mrow></munder><msup><mi>F</mi><mi>n</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>n</mi></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>−</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msub><mi>ξ</mi><mi>∞</mi></msub><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>−</mi><mn>1</mn><mi>/</mi><msub><mi>ξ</mi><mi>∞</mi></msub></mrow></msup><mo stretchy="true" form="postfix">}</mo></mrow><mo>=</mo><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
 \lim_{n \to \infty} F^n(a_nx+b_n) = \exp\left\{-(1+\xi_\infty x)^{-1/\xi_\infty}\right\}=G(x).
\end{align*}</annotation></semantics></math></p>
<p><span class="citation">Smith (1987)</span> shows that, for any
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mi>y</mi><mo>:</mo><mn>1</mn><mo>+</mo><msub><mi>ξ</mi><mi>∞</mi></msub><mi>y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">x \in \{y:1+\xi_\infty y &gt;0\}</annotation></semantics></math>,
there exists
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
such that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mfrac><mrow><mi>−</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>F</mi><mo stretchy="false" form="prefix">{</mo><mi>v</mi><mo>+</mo><mi>x</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mi>−</mi><mo>log</mo><mo stretchy="false" form="prefix">{</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></mfrac><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">{</mo><mn>1</mn><mo>+</mo><mi>x</mi><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mi>−</mi><mn>1</mn><mi>/</mi><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mo>,</mo><mspace width="2.0em"></mspace><mi>v</mi><mo>&lt;</mo><mi>z</mi><mo>&lt;</mo><mi>v</mi><mo>+</mo><mi>x</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
   \frac{-\log[F\{v+xs(v)\}]}{-\log\{F(v)\}} = \left\{1+xs'(z)\right\}^{-1/s'(z)}, \qquad v &lt; z &lt; v+xs(v).
\end{align*}</annotation></semantics></math> For each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n \geq 1</annotation></semantics></math>,
setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><msub><mi>b</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">v=b_n</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>n</mi></msub><mo>=</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a_n=s(b_n)</annotation></semantics></math>
yields
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>F</mi><mi>n</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>n</mi></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>−</mi><msup><mrow><mo stretchy="true" form="prefix">{</mo><mn>1</mn><mo>+</mo><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>x</mi><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mi>−</mi><mn>1</mn><mi>/</mi><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><mi mathvariant="normal">O</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>n</mi><mrow><mi>−</mi><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
   F^n(a_nx+b_n)=\exp\left[-\left\{1+s'(z)x\right\}^{-1/s'(z)}\right] + \mathrm{O}(n^{-1})
\end{align*}</annotation></semantics></math> for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>n</mi></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><mo>,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>n</mi></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><mo>,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">z \in [\min(a_nx+b_n, b_n), \max(a_nx+b_n, b_n)]</annotation></semantics></math>,
depending on the support of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>.
The ultimate approximation replaces
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s'(z)</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>x</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>ξ</mi><mi>∞</mi></msub></mrow><annotation encoding="application/x-tex">s'(x^*)=\xi_{\infty}</annotation></semantics></math>,
whereas <span class="citation">Smith (1987)</span> suggests instead
suggests taking
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s'(b_n)</annotation></semantics></math>,
which is closer to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>n</mi></msub><mi>x</mi><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s'(a_nx+b_n)</annotation></semantics></math>
than is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>x</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s'(x^*)</annotation></semantics></math>.</p>
<p>The maximum likelihood estimate of the shape should change as the
threshold or the block size increases. Consider for simplicity yearly
maxima arising from blocking
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>n</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">m=n_y</annotation></semantics></math>
observations per year. We are interested in the distribution of the
maximum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
years and thus the target has roughly shape
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ξ</mi><mrow><mi>N</mi><msub><mi>n</mi><mi>y</mi></msub></mrow></msub><annotation encoding="application/x-tex">\xi_{Nn_y}</annotation></semantics></math>,
but our estimates will instead give approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ξ</mi><msub><mi>n</mi><mi>y</mi></msub></msub><annotation encoding="application/x-tex">\xi_{n_y}</annotation></semantics></math>;
an extrapolation error arises from this mismatch between the shape
values, which would be constant if the observations were truly
max-stable. The curvature of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">s'</annotation></semantics></math>
determines how stable the estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ξ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\xi_t</annotation></semantics></math>
are when the extrapolation window increases.</p>
<p>We illustrate the previous discussion by looking at block maximum
from a log-normal distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lbelzile.github.io/mev/" class="external-link">mev</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    <span class="fu"><a href="../reference/fit.gev.html">fit.gev</a></span><span class="op">(</span></span>
<span>      xdat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>        X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">30</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, </span>
<span>               ncol <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, </span>
<span>        MARGIN <span class="op">=</span> <span class="fl">1</span>, </span>
<span>        FUN <span class="op">=</span> <span class="va">max</span><span class="op">)</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">est</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">penult.bm.lnorm</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mev</span><span class="fu">::</span><span class="fu"><a href="../reference/smith.penult.html">smith.penult</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"bm"</span>,</span>
<span>                    m <span class="op">=</span> <span class="op">(</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">fitted</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"estimated shape"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span></span>
<span>  y0 <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>  y1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  x0 <span class="op">=</span> <span class="va">penult.bm.lnorm</span><span class="op">$</span><span class="va">shape</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span></span>
<span>  y0 <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>  y1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  x0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p30</span> <span class="op">&lt;-</span> <span class="va">penult.bm.lnorm</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">N30</span> <span class="op">=</span> <span class="va">N</span> <span class="op">/</span> <span class="fl">30</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">N</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">plnorm</a></span><span class="op">(</span><span class="va">x</span>, log.p <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"density"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Get parameters of maximum of N GEV</span></span>
<span><span class="va">maxstabp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">loc</span>, <span class="va">scale</span>, <span class="va">shape</span>, <span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">shape</span>, <span class="fl">0</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mut</span> <span class="op">&lt;-</span> <span class="va">loc</span> <span class="op">-</span> <span class="va">scale</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">N</span> <span class="op">^</span> <span class="va">shape</span><span class="op">)</span> <span class="op">/</span> <span class="va">shape</span></span>
<span>    <span class="va">sigmat</span> <span class="op">=</span> <span class="va">scale</span> <span class="op">*</span> <span class="va">N</span> <span class="op">^</span> <span class="va">shape</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      loc <span class="op">=</span> <span class="va">mut</span>,</span>
<span>      scale <span class="op">=</span> <span class="va">sigmat</span>,</span>
<span>      shape <span class="op">=</span> <span class="va">shape</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">mut</span> <span class="op">&lt;-</span> <span class="va">loc</span> <span class="op">+</span> <span class="va">scale</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      loc <span class="op">=</span> <span class="va">mut</span>,</span>
<span>      scale <span class="op">=</span> <span class="va">scale</span>,</span>
<span>      shape <span class="op">=</span> <span class="va">shape</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">p30e</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">maxstabp</span><span class="op">(</span></span>
<span>    loc <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">loc</span>,</span>
<span>    scale <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">scale</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">shape</span>,</span>
<span>    N <span class="op">=</span> <span class="va">N30</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gev.html" class="external-link">dgev</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    loc <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'loc'</span><span class="op">]</span>,</span>
<span>    scale <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'scale'</span><span class="op">]</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'shape'</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p30l</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">maxstabp</span><span class="op">(</span></span>
<span>    loc <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">loc</span>,</span>
<span>    scale <span class="op">=</span> <span class="va">p30</span><span class="op">$</span><span class="va">scale</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    N <span class="op">=</span> <span class="va">N30</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gev.html" class="external-link">dgev</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    loc <span class="op">=</span> <span class="va">p30e</span><span class="op">[</span><span class="st">'loc'</span><span class="op">]</span>,</span>
<span>    scale <span class="op">=</span> <span class="va">p30l</span><span class="op">[</span><span class="st">'scale'</span><span class="op">]</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exact"</span>, <span class="st">"ultimate"</span>, <span class="st">"penultimate"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="03-penultimate_files/figure-html/penult-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>The left panel illustrates how maximum likelihood estimates of the
parameters for repeated samples from a log-normal distribution are
closer to the penultimate approximation than to the limiting tail index
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ξ</mi><mi>∞</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\xi_{\infty}=0</annotation></semantics></math>.
Using max-stability, we could get an estimate of the distribution of the
maximum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><msub><mi>n</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">Nn_y</annotation></semantics></math>
observations. In this case, the penultimate shape for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">m=1000</annotation></semantics></math>
is approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ξ</mi><mn>1000</mn></msub><mo>=</mo><mn>0.215</mn></mrow><annotation encoding="application/x-tex">\xi_{1000}=0.215</annotation></semantics></math>,
compared to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ξ</mi><mn>30</mn></msub><mo>≈</mo><mn>0.284</mn></mrow><annotation encoding="application/x-tex">\xi_{30} \approx 0.284</annotation></semantics></math>,
which is far from the limiting value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ξ</mi><mi>∞</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\xi_{\infty}=0</annotation></semantics></math>.
The extrapolated density estimate is based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>F</mi><mn>1</mn><mrow><mn>1000</mn><mi>/</mi><mn>30</mn></mrow></msubsup><annotation encoding="application/x-tex">F_1^{1000/30}</annotation></semantics></math>,
the generalized extreme value density associated to the distribution
function of the penultimate approximation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>F</mi><mn>1</mn><mrow><mn>1000</mn><mi>/</mi><mn>30</mn></mrow></msubsup><annotation encoding="application/x-tex">F_1^{1000/30}</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>1</mn></msub><mo>∼</mo><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>30</mn></msub><mo>,</mo><msub><mi>b</mi><mn>30</mn></msub><mo>,</mo><msub><mi>ξ</mi><mn>30</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_1 \sim\mathsf{GEV}(a_{30}, b_{30}, \xi_{30})</annotation></semantics></math>.
The penultimate approximation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mn>2</mn></msub><annotation encoding="application/x-tex">F_2</annotation></semantics></math>
is more accurate than the ultimate approximation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>30</mn></msub><mo>,</mo><msub><mi>b</mi><mn>30</mn></msub><mo>,</mo><msub><mi>ξ</mi><mi>∞</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathsf{GEV}(a_{30}, b_{30}, \xi_\infty)</annotation></semantics></math>,
which is too short tailed.</p>
<p>The function <code>smith.penult</code> computes the penultimate
approximation for parameter models in <strong>R</strong> for the
distribution assuming a model <code>family</code> with arguments
<code>dfamily</code>, <code>qfamily</code> and <code>pfamily</code>
exist. It returns the penultimate parameters for a given block size or
quantile in case of threshold models. These functions are particularly
useful for simulation studies in which one wants to obtain an
approximation for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>F</mi><mi>N</mi></msup><annotation encoding="application/x-tex">F^N</annotation></semantics></math>
for large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
to get an approximation to the asymptotic distribution of a test
statistic for finite
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>;
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝖦</mi><mi>𝖤</mi><mi>𝖵</mi></mrow><annotation encoding="application/x-tex">\mathsf{GEV}</annotation></semantics></math>
penultimate approximation is more numerically stable for certain models
and its moments and cumulants are easily derived.</p>
<p>The following plot illustrates the penultimate shape parameter for
the normal distribution based on threshold exceedances. In finite
samples, the upper tail is bounded, but the quality of the approximation
by the Gumbel distribution increases as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>→</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">u \to \infty</annotation></semantics></math>,
albeit very slowly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9999</span>, by <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span></span>
<span><span class="va">penult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smith.penult.html">smith.penult</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"pot"</span>,</span>
<span>                       u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">u</span>,</span>
<span>  <span class="va">penult</span><span class="op">$</span><span class="va">shape</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'quantile'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">'penultimate shape'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="03-penultimate_files/figure-html/penultimateshape-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>While the above discussion has been restricted to block maxima and
the generalized extreme value distribution, similar results exists for
peaks over threshold using a generalized Pareto distribution. For
threshold exceedances, we start with the reciprocal hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>−</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mi>/</mi><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">r(x) = \{1-F(x)\}/f(x)</annotation></semantics></math>
in place of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(x)</annotation></semantics></math>.
The normalizing constants are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>,</mo><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(u, r(u))</annotation></semantics></math>
and the penultimate shape parameter for the generalized Pareto
distribution is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">r'(u)</annotation></semantics></math>.</p>
<p>We can relate threshold exceedances to the distribution of maxima as
follows: suppose a generalized Pareto distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
is fitted to threshold exceedances above a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>,
with parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ζ</mi><mi>u</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>u</mi></msub><mo>,</mo><mi>ξ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\zeta_u, \sigma_u, \xi)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>u</mi></msub><annotation encoding="application/x-tex">\zeta_u</annotation></semantics></math>
denotes the unknown proportion of points above the threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>.
If there are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>y</mi></msub><annotation encoding="application/x-tex">n_y</annotation></semantics></math>
observations per year on average, then the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>-year
return level is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mn>1</mn><mi>/</mi><mi>T</mi></mrow></msub><mo>=</mo><mi>u</mi><mo>+</mo><msub><mi>σ</mi><mi>u</mi></msub><mi>/</mi><mi>ξ</mi><mo stretchy="false" form="prefix">{</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><msub><mi>n</mi><mi>y</mi></msub><msub><mi>ζ</mi><mi>u</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>ξ</mi></msup><mo>−</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">z_{1/T}=u+\sigma_u/\xi\{(Tn_y\zeta_u)^\xi-1\}</annotation></semantics></math>.
We take
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>F</mi><mrow><msub><mi>ζ</mi><mi>u</mi></msub><mi>T</mi><msub><mi>n</mi><mi>y</mi></msub></mrow></msup><annotation encoding="application/x-tex">F^{\zeta_uTn_y}</annotation></semantics></math>
as the approximation to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>-year
maxima distribution, conditional on exceeding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="exercice">Exercice<a class="anchor" aria-label="anchor" href="#exercice"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Sample observations from the standard Gaussian distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝖭</mi><mi>𝗈</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathsf{No}(0,1)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>25</mn><mo>,</mo><mn>50</mn><mo>,</mo><mn>100</mn><mo>,</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">m = 25, 50, 100, 1000</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">k=1000</annotation></semantics></math>
replications.</li>
<li>Fit a generalized extreme value distribution to block maxima of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
Obtain an estimate of the distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1000000</mn></mrow><annotation encoding="application/x-tex">m = 1000000</annotation></semantics></math>
observations from a standard Gaussian using max-stability (the functions
<code>fit.gev</code> and <code>gev.mle</code> can be useful).</li>
<li>Plot the density of the resulting approximations and compare them to
the density of the true distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>Φ</mi><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N\phi(x)\Phi^{N-1}(x)</annotation></semantics></math>.</li>
<li>Superpose the density of the penultimate approximation for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1000000</mn></mrow><annotation encoding="application/x-tex">m = 1000000</annotation></semantics></math>
obtained using the Smith penultimate approximation
(<code>smith.penult</code>).</li>
</ol>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Smith:1987" class="csl-entry">
Smith, Richard L. 1987. <span>“Approximations in Extreme Value
Theory.”</span> Edited by University of North Carolina Chapel Hill
Center for Stochastic Processes.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Leo Belzile, Jennifer L. Wadsworth, Paul J. Northrop, Scott D. Grimshaw, Raphael Huser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
