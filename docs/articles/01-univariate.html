<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mev">
<title>Likelihood based inference for univariate extremes • mev</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Likelihood based inference for univariate extremes">
<meta property="og:description" content="mev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.13.5000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-univariate.html">Likelihood based inference for univariate extremes</a>
    <a class="dropdown-item" href="../articles/02-threshold.html">Threshold selection</a>
    <a class="dropdown-item" href="../articles/03-penultimate.html">Penultimate approximations</a>
    <a class="dropdown-item" href="../articles/04-simulation.html">Simulation of multivariate extreme value distributions and processes</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lbelzile/mev/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Likelihood based inference for univariate extremes</h1>
                        <h4 data-toc-skip class="author">Léo
Belzile</h4>
            
            <h4 data-toc-skip class="date">2022-04-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/mev/blob/HEAD/vignettes/01-univariate.Rmd" class="external-link"><code>vignettes/01-univariate.Rmd</code></a></small>
      <div class="d-none name"><code>01-univariate.Rmd</code></div>
    </div>

    
    
<p>The <code>mev</code> package provides gradient-based optimization
routines for fitting univariate extreme value models, either block
maxima or threshold exceedances, using one of four likelihoods: that of
the generalized extreme value distribution, the generalized Pareto
distribution, and the inhomogeneous Poisson point process and the <span class="math inline">\(r\)</span>-largest order statistics.</p>
<p>Relative to other packages such as <code>evd</code> or
<code>ismev</code>, the package functions include analytic expressions
for the score and observed informations, with careful interpolation when
<span class="math inline">\(\xi \approx 0\)</span>. However,
<code>mev</code> does not handle generalized linear or generalized
additive models for the parameters, to avoid having as many inequality
constraints in the optimization as there are observations times the
number of covariates.</p>
<div class="section level2">
<h2 id="basic-theory">Basic theory<a class="anchor" aria-label="anchor" href="#basic-theory"></a>
</h2>
<p>Let <span class="math inline">\(\ell(\boldsymbol{y};
\boldsymbol{\theta})\)</span> denotes the log-likelihood of an <span class="math inline">\(n\)</span> sample with a <span class="math inline">\(p\)</span>-dimensional parameter <span class="math inline">\(\boldsymbol{\theta}\)</span>. The score vector is
<span class="math inline">\(U(\boldsymbol{\theta})=\partial \ell /
\partial \boldsymbol{\theta}\)</span>, while the Fisher information is
<span class="math inline">\(i(\boldsymbol{\theta})=\mathrm{E}\{U(\boldsymbol{\theta})U(\boldsymbol{\theta})^\top\}\)</span>.
Under regularity conditions, we also have <span class="math inline">\(i(\boldsymbol{\theta}) = - \mathrm{E}(\partial^2
\ell / \partial \boldsymbol{\theta}\partial
\boldsymbol{\theta}^\top)\)</span>. The observed information is the
negative Hessian <span class="math inline">\(-\partial^2 \ell / \partial
\boldsymbol{\theta}\partial \boldsymbol{\theta}^\top\)</span>, evaluated
at the maximum likelihood estimator <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span>.</p>
<p>By definition, the maximum likelihood estimator solves the score
equation, i.e. <span class="math inline">\(U(\hat{\boldsymbol{\theta}})=\boldsymbol{0}_p\)</span>.
If the maximum likelihood estimator is not available in closed-form, its
solution is found numerically and this property can be used to verify
that the optimization routine has converged or for gradient-based
maximization algorithms.</p>
<div class="section level3">
<h3 id="likelihoods">Likelihoods<a class="anchor" aria-label="anchor" href="#likelihoods"></a>
</h3>
<p>There are four basic likelihoods for univariate extremes: the
likelihood of the generalized extreme value (GEV) distribution for block
maxima, the likelihood for the generalized Pareto distribution and that
of the non-homogeneous Poisson process (NHPP) for exceedances above a
threshold <span class="math inline">\(u\)</span> and lastly the
likelihood of the <span class="math inline">\(r\)</span>-largest
observations.</p>
</div>
<div class="section level3">
<h3 id="generalized-extreme-value-distribution">Generalized extreme value distribution<a class="anchor" aria-label="anchor" href="#generalized-extreme-value-distribution"></a>
</h3>
<p>The generalized extreme value (GEV) distribution with location
parameter <span class="math inline">\(\mu \in \mathbb{R}\)</span>, scale
parameter <span class="math inline">\(\sigma \in \mathbb{R}_{+}\)</span>
and shape parameter <span class="math inline">\(\xi \in
\mathbb{R}\)</span> is <span class="math display">\[\begin{align*}
  G(x)  =
\begin{cases}
\exp\left\{-\left(1+\xi \frac{x-\mu}{\sigma}\right)^{-1/\xi}\right\},
&amp;  \xi \neq 0,\\
\exp \left\{ -\exp \left(-\frac{x-\mu}{\sigma}\right)\right\},&amp;  \xi
= 0,
\end{cases}
\end{align*}\]</span> defined on <span class="math inline">\(\{x \in
\mathbb{R}: \xi(x-\mu)/\sigma &gt; -1\}\)</span> where <span class="math inline">\(x_{+} = \max\{0, x\}\)</span>. The case <span class="math inline">\(\xi=0\)</span> is commonly known as the Gumbel
distribution. We denote the distribution by <span class="math inline">\(\mathsf{GEV}(\mu, \sigma, \xi)\)</span>. This
distribution is suitable for maximum of a large number of observations:
the larger the block size, the closer the approximation will be. The
<code>fit.gev</code> function includes two optimization routines: either
use the PORT methods from <code>nlminb</code>, or
Broyden-Fletcher-Goldfarb-Shanno algorithm (<code>BFGS</code>) inside a
constrained optimization algorithm (augmented Lagrangian). The default
option is <code>nlminb</code>, which sometimes returns diagnostics
indicating false convergence when the model is near the maximum
likelihood estimate.</p>
<p>As for other model, parameters can be fixed and nested models can be
compared using the <code>anova</code> S3 method. For these, we
distinguish between estimated coefficients (<code>estimate</code>) or
with the <code>coef</code> method, and the full vector of parameters,
<code>param</code>.</p>
<p>We use the GEV model to illustrate some of the capabilities of the
<code>mev</code> package for profiling</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fetch data and dates (see ?maiquetia)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">maiquetia</span>, package <span class="op">=</span> <span class="st">"mev"</span><span class="op">)</span>
<span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1961-01-01"</span><span class="op">)</span>, 
                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1999-12-31"</span><span class="op">)</span>, 
                by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="co"># Compute yearly maximum of daily rainfall</span>
<span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">maiquetia</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">day</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, <span class="va">max</span><span class="op">)</span></code></pre></div>
<p>We can compute the profile log likelihood for the mean of the 50-year
maximum distribution, excluding data from 1999, to assess how extreme
the Maiquetia disaster was.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creates plot by default</span>
<span class="va">prof</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gev.pll.html">gev.pll</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"Nmean"</span>, 
        mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"profile"</span>, <span class="st">"tem"</span><span class="op">)</span>, 
        dat <span class="op">=</span> <span class="va">ymax</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ymax</span><span class="op">)</span><span class="op">]</span>,
        N <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<p><img src="01-univariate_files/figure-html/maiquetia_profile-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Confidence intervals</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">prof</span>, print <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Point estimate for the parameter of interest psi:</span>
<span class="co">## Maximum likelihood          : 174.641 </span>
<span class="co">## Tangent exponential model   : 178.219 </span>
<span class="co">## </span>
<span class="co">## Confidence intervals, levels : 0.025 0.975 </span>
<span class="co">## Wald intervals               : 84.418 264.864 </span>
<span class="co">## Profile likelihood           : 119.925 529.129 </span>
<span class="co">## Tangent exponential model    : 122.415 534.336</span></code></pre>
<p>The Maiquetia rainfall data (<code>maiquetia</code>) contains daily
cumulated rainfall measures (in mm) from the Simon Bolivar airport in
the state of Vargas, Venezuela, which was hit by torrential floods in
December 1999. We reduce these measurements to yearly maximum and fit a
generalized extreme value distribution, targeting the expectation of the
distribution of 50-year maximum as risk measure. The
<code>confint</code> method returns associated confidence intervals: we
can see that the symmetry Wald intervals, which fail to account for the
asymmetry of the profile, are much too narrow relative to the profile
likelihood and higher-order approximations. The function can be used for
a variety of univariate risk functionals and try to find a good grid of
candidate values for the profiling.</p>
</div>
<div class="section level3">
<h3 id="generalized-pareto-distribution">Generalized Pareto distribution<a class="anchor" aria-label="anchor" href="#generalized-pareto-distribution"></a>
</h3>
<p>The generalized Pareto (GP) distribution with scale <span class="math inline">\(\sigma \in \mathbb{R}_{+}\)</span> and shape <span class="math inline">\(\xi \in \mathbb{R}\)</span> is <span class="math display">\[\begin{align*}
  G(x)  =
\begin{cases}
1-\left(1+\xi \frac{x}{\sigma}\right)_{+}^{-1/\xi}, &amp;  \xi \neq 0,\\
1-
\exp \left(-\frac{x}{\sigma}\right),&amp;  \xi = 0.
\end{cases}
\end{align*}\]</span> The range of the generalized Pareto distribution
is <span class="math inline">\([0, -\sigma/\xi)\)</span> if <span class="math inline">\(\xi &lt; 0\)</span> and is <span class="math inline">\(\mathbb{R}_{+}\)</span> otherwise. We denote the
distribution by <span class="math inline">\(\mathsf{GP}(\sigma,
\xi)\)</span>. The default optimization algorithm for this model is that
of <span class="citation">Grimshaw (1993)</span>, which reduces the
dimension of the optimization through profiling. The exponential
distribution and the case <span class="math inline">\(\xi=-1\)</span>
are handled separately. If the sample coefficient of variation is less
than one, the global maximum lies on the boundary of the parameter space
since there exists for any <span class="math inline">\(\xi&lt;-1\)</span> a value <span class="math inline">\(\sigma^*\)</span> such that <span class="math inline">\(\ell(\sigma^*, \xi) \to \infty\)</span>: the
search is thus restricted to <span class="math inline">\(\xi \geq
-1\)</span>. These cases are more frequent in small samples due to the
negative bias of the maximum likelihood estimator of the shape.</p>
<p>Except for this boundary case, the maximum likelihood estimator
solves the score equation <span class="math inline">\(\partial
\ell(\boldsymbol{\theta}) / \partial \boldsymbol{\theta} =
\boldsymbol{0}_2\)</span>. We can thus check convergence by verifying
that the score vanishes at the maximum likelihood estimate.</p>
<p>If <span class="math inline">\(\widehat{\xi} &lt; -0.5\)</span>, the
asymptotic regime is nonstandard <span class="citation">(Smith
1985)</span> and the standard errors obtained from the inverse
information matrix are unreliable; as such, <code>mev</code> does not
report them and prints an optional warning.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lbelzile.github.io/mev/" class="external-link">mev</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gpd.html" class="external-link">rgpd</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, shape <span class="op">=</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">)</span>
<span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, threshold <span class="op">=</span> <span class="fl">0</span>, show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Method: Grimshaw </span>
<span class="co">## Log-likelihood: NaN </span>
<span class="co">## </span>
<span class="co">## Threshold: 0 </span>
<span class="co">## Number Above: 10 </span>
<span class="co">## Proportion Above: 1 </span>
<span class="co">## </span>
<span class="co">## Estimates</span>
<span class="co">## scale  shape  </span>
<span class="co">##  1.22  -1.00  </span>
<span class="co">## </span>
<span class="co">## Standard Errors</span>
<span class="co">## scale  shape  </span>
<span class="co">##    NA     NA  </span>
<span class="co">## </span>
<span class="co">## Optimization Information</span>
<span class="co">##   Convergence: successful</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Empirical coefficient of variation</span>
<span class="co"># Theoretical quantity defined as standard deviation/mean</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.6094863</span></code></pre>
<p><img src="01-univariate_files/figure-html/gpprofile-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The figure shows the profile likelihood for <span class="math inline">\(\eta = -\xi/\sigma\)</span> for two datasets, one
of which (leftmost) achieves its maximum at <span class="math inline">\(\widehat{\xi} = -1\)</span> and <span class="math inline">\(\widehat{\eta} =
1/\max(\boldsymbol{y})\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Another example where the solution lies inside the parameter space</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">evd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/evd/man/gpd.html" class="external-link">rgpd</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">25</span>, shape <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, threshold <span class="op">=</span> <span class="fl">0</span>, show <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># Check convergence - is gradient zero?</span>
<span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="../reference/gpd.score.html">gpd.score</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitted</span><span class="op">)</span>, dat <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Various methods are available</span>
<span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"mev_gpd"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] anova  coef   logLik nobs   plot   print  vcov  </span>
<span class="co">## see '?methods' for accessing help and source code</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># P-P and Q-Q diagnostic plots </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitted</span><span class="op">)</span></code></pre></div>
<p><img src="01-univariate_files/figure-html/gp2-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit exponential by passing a list with a fixed parameter</span>
<span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, threshold <span class="op">=</span> <span class="fl">0</span>, fpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="co"># The MLE is sample mean of exceedances - check this</span>
<span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">reduced</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compare models using likelihood ratio test</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fitted</span>, <span class="va">reduced</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Analysis of Deviance Table</span>
<span class="co">## </span>
<span class="co">##         npar Deviance Df  Chisq Pr(&gt;Chisq)</span>
<span class="co">## fitted     2   50.439                     </span>
<span class="co">## reduced    1   52.893  1 2.4534     0.1173</span></code></pre>
<p>The <code>mev</code> package includes alternative routines for
estimation, including the optimal bias-robust estimator of <span class="citation">Dupuis (1999)</span> and the approximate Bayesian
estimators of <span class="citation">Zhang and Stephens (2009)</span>
and <span class="citation">Zhang (2010)</span>. The latter two are
obtained by running a Markov chain Monte Carlo algorithm, but only the
posterior mean and standard deviation are returned to reduce the memory
footprint of the returned object, and these are calculated on the fly
using running mean and variance estimators.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bayesian point estimates (based on MAP)</span>
<span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, threshold <span class="op">=</span> <span class="fl">0</span>, 
        show <span class="op">=</span> <span class="cn">TRUE</span>, 
        method <span class="op">=</span> <span class="st">"zhang"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Method: Zhang </span>
<span class="co">## </span>
<span class="co">## Threshold: 0 </span>
<span class="co">## Number Above: 25 </span>
<span class="co">## Proportion Above: 1 </span>
<span class="co">## </span>
<span class="co">## Approximate posterior mean estimates</span>
<span class="co">##  scale   shape  </span>
<span class="co">##  1.242  -0.198</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With MCMC</span>
<span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, threshold <span class="op">=</span> <span class="fl">0</span>, 
        show <span class="op">=</span> <span class="cn">TRUE</span>, 
        MCMC <span class="op">=</span> <span class="cn">TRUE</span>,
        method <span class="op">=</span> <span class="st">"zhang"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Method: Zhang </span>
<span class="co">## </span>
<span class="co">## Threshold: 0 </span>
<span class="co">## Number Above: 25 </span>
<span class="co">## Proportion Above: 1 </span>
<span class="co">## </span>
<span class="co">## Approximate posterior mean estimates</span>
<span class="co">##  scale   shape  </span>
<span class="co">##  1.242  -0.198  </span>
<span class="co">## </span>
<span class="co">## Posterior mean estimates</span>
<span class="co">##  scale   shape  </span>
<span class="co">##  1.314  -0.239  </span>
<span class="co">## </span>
<span class="co">## Monte Carlo standard errors</span>
<span class="co">## scale  shape  </span>
<span class="co">## 0.174  0.151  </span>
<span class="co">## </span>
<span class="co">## Estimates based on an adaptive MCMC</span>
<span class="co">##  Runs:    10000 </span>
<span class="co">##  Burnin:  3000 </span>
<span class="co">##  Acceptance rate: 0.4 </span>
<span class="co">##  Thinning: 1</span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># OBRE fit - a weight, attached to the largest</span>
<span class="co"># observations is returned</span>
<span class="va">fit_robust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">dat</span>, 
                      threshold <span class="op">=</span> <span class="fl">0</span>, 
                      show <span class="op">=</span> <span class="cn">TRUE</span>, 
                      method <span class="op">=</span> <span class="st">"obre"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Method: obre </span>
<span class="co">## Log-likelihood: -Inf </span>
<span class="co">## </span>
<span class="co">## Threshold: 0 </span>
<span class="co">## Number Above: 25 </span>
<span class="co">## Proportion Above: 1 </span>
<span class="co">## </span>
<span class="co">## Estimates</span>
<span class="co">##   scale    shape  </span>
<span class="co">##  1.3525  -0.4338  </span>
<span class="co">## </span>
<span class="co">## Standard Errors</span>
<span class="co">##  scale   shape  </span>
<span class="co">## 0.3531  0.2775  </span>
<span class="co">## </span>
<span class="co">## Optimization Information</span>
<span class="co">##   Convergence: Solution not feasible; algorithm aborted. </span>
<span class="co">##   Function Evaluations: 4</span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># See fit_robust$weights</span>

<span class="co"># First-order bias corrected estimates</span>
<span class="va">corr_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gpd.bcor.html">gpd.bcor</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitted</span><span class="op">)</span>, 
                      dat <span class="op">=</span> <span class="va">dat</span>, 
                      corr <span class="op">=</span> <span class="st">"firth"</span><span class="op">)</span>

<span class="co"># Many methods are available for these objects</span>
<span class="co"># including the following `S3` classes</span>
<span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"mev_gpd"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] anova  coef   logLik nobs   plot   print  vcov  </span>
<span class="co">## see '?methods' for accessing help and source code</span></code></pre>
</div>
<div class="section level3">
<h3 id="inhomogeneous-poisson-process">Inhomogeneous Poisson process<a class="anchor" aria-label="anchor" href="#inhomogeneous-poisson-process"></a>
</h3>
<p>Let <span class="math inline">\(Y_{(1)} \geq \cdots \geq
Y_{(r)}\)</span> denote the <span class="math inline">\(r\)</span>
largest observations from a sample. The likelihood of the limiting
distribution of the point process for the <span class="math inline">\(r\)</span>-largest observations is, for <span class="math inline">\(\mu,\xi\in\mathbb{R}, \sigma&gt;0\)</span>, <span class="math display">\[
\ell(\mu,\sigma,\xi; \boldsymbol{y}) \equiv  -r\log(\sigma) -
\left(1+\frac{1}{\xi}\right)\sum_{j=1}^r \log\left(1 +
\xi\frac{y_{(j)}-\mu}{\sigma}\right)_{+} - \left(1 +
\xi\frac{y_{(r)}-\mu}{\sigma}\right)^{-1/\xi}_+.
\]</span> This likelihood can be used to model the <span class="math inline">\(r\)</span>-largest observations per block or
threshold exceedances where the threshold is the <span class="math inline">\(r\)</span>th order statistic</p>
<p>Consider a sample of <span class="math inline">\(N\)</span>
observations, of which <span class="math inline">\(n_u\)</span> exceed
<span class="math inline">\(u\)</span> and which we denote by <span class="math inline">\(y_1, \ldots, y_{n_u}\)</span>. The likelihood
associated to the limiting distribution of threshold exceedances is, for
<span class="math inline">\(\mu, \xi \in \mathbb{R}, \sigma
&gt;0\)</span>, <span class="math display">\[\begin{align}
L(\mu, \sigma, \xi; \boldsymbol{y}) = \exp \left[ - c \left\{1+ \xi
\left( \frac{u-\mu}{\sigma}\right)\right\}^{-1/\xi}_{+}\right]
(c\sigma)^{-n_u}\prod_{i=1}^{n_u} \left\{1+\xi\left(
\frac{y_i-\mu}{\sigma}\right)\right\}^{-1/\xi-1}_{+},\label{eq:ppp_lik}
\end{align}\]</span> where <span class="math inline">\((\cdot)_{+} =
\max\{0, \cdot\}\)</span>. The quantity <span class="math inline">\(c\)</span> is a tuning parameter whose role is
described in 7.5 of <span class="citation">Coles (2001)</span>. If we
take <span class="math inline">\(c=N/m\)</span>, the parameters of the
point process likelihood correspond to those of the generalized extreme
value distribution fitted to blocks of size <span class="math inline">\(m\)</span>. The NHPP likelihood includes a
contribution for the fraction of points that exceeds the threshold,
whereas the generalized Pareto is a conditional distribution, whose
third parameter is the normalizing constant <span class="math inline">\(\zeta_u=\Pr(Y&gt;u)\)</span>. Since the latter has
a Bernoulli and <span class="math inline">\(\zeta_u\)</span> is
orthogonal to the pair <span class="math inline">\((\sigma,
\xi)\)</span>, it is often omitted from further analyses and estimated
as the proportion of samples above the threshold.</p>
<p>The model includes additional arguments, <code>np</code> and
<code>npp</code> (number of observations per period). If data are
recorded on a daily basis, using a value of <code>npp = 365.25</code>
yields location and scale parameters that correspond to those of the
generalized extreme value distribution fitted to block maxima.
Alternatively, one can specify instead the number of periods
<code>np</code>, akin to <span class="math inline">\(n_y\)</span> in Eq.
7.8 of <span class="citation">Coles (2001)</span> — only the latter is
used by the function, with <code>npp*np</code> theoretically equal to
the number of exceedances.</p>
<p>The tuning parameters impact the convergence of the estimation since
the dependence between parameters becomes very strong: <span class="citation">Sharkey and Tawn (2017)</span> suggest to pick a value
of <code>np</code> that near-orthogonalize the parameters.
Wadsworth:2011 recommended picking this to be the number of observations
(so <code>npp=1</code>). Another option is to fit the generalized Pareto
model: if the probability of exceeding threshold <span class="math inline">\(u\)</span> is small, the Poisson approximation to
binomial distribution implies <span class="math display">\[c \left\{1+
\xi \left( \frac{u-\mu}{\sigma}\right)\right\}^{-1/\xi} \approx n_u,
\]</span> where <span class="math inline">\(n_u\)</span> is the number
of threshold exceedances above <span class="math inline">\(u\)</span>
and <span class="math inline">\(c\)</span> is the tuning parameter
<code>np</code>. With the point estimates of the generalized Pareto
model, say <span class="math inline">\((\widehat{\sigma}_u,
\widehat{\xi})\)</span>, we thus use <span class="math display">\[\begin{align*}
\mu_0 &amp;= u - \sigma_0\{(n_u/c)^{-\widehat{\xi}}-1\}/\widehat{\xi},\\
\sigma_0 &amp;= \widehat{\sigma}_u\times (n_u/c)^{\widehat{\xi}},
\end{align*}\]</span> and <span class="math inline">\(\xi_0=\widehat{\xi}\)</span> as starting values.
Most of the time, these values are so close to the solution of the score
equation that numerical convergence of the optimization routine is all
but guaranteed in a few likelihood evaluations.</p>
<p>Due to the support constraints, the objective function can be
multimodal, as evidenced by the following figure: the gray area
indicates feasible parameters and showcase other instances where local
maxima are on the boundary of the parameter space. Using different
starting values is advisable if some parameters are held fixed as they
may lead to different optimum.
<img src="01-univariate_files/figure-html/ppfitmultimodal-1.png" width="576" style="display: block; margin: auto;"></p>
<p>If no starting value is provided and some fixed parameters are
provided, the model will approximate the distribution of the vector of
parameters by a multivariate Gaussian distribution and compute the best
linear predictor of the remaining parameters given those are fixed. This
method works well if the log-likelihood is near quadratic and the values
are not too far from the maximum, but does not deal with the boundary
constraints. In case these starting values are invalid, and an error
message is returned.</p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-inference">Statistical inference<a class="anchor" aria-label="anchor" href="#statistical-inference"></a>
</h2>
<p>This section presents some test statistics that can easily be
computed using some of the functionalities of <code>mev</code>, as well
as confidence intervals for parameters and common functionals, based on
the profile likelihood.</p>
<p>The three main type of test statistics for likelihood-based inference
are the Wald, score and likelihood ratio tests. The three main classes
of statistics for testing a simple null hypothesis <span class="math inline">\(\mathscr{H}_0:
\boldsymbol{\theta}=\boldsymbol{\theta}_0\)</span> against the
alternative <span class="math inline">\(\mathscr{H}_a:
\boldsymbol{\theta} \neq \boldsymbol{\theta}_0\)</span> are the
likelihood ratio, the score and the Wald statistics, defined
respectively as <span class="math display">\[\begin{align*}
w &amp;= 2 \left\{
\ell(\hat{\boldsymbol{\theta}})-\ell(\boldsymbol{\theta}_0)\right\},\qquad
\\w_{\mathsf{score}} &amp;=
U^\top(\boldsymbol{\theta}_0)i^{-1}(\boldsymbol{\theta}_0)U(\boldsymbol{\theta}_0),\qquad
\\ w_{\mathsf{wald}} &amp;=
(\hat{\boldsymbol{\theta}}-\boldsymbol{\theta}_0)^\top
i(\boldsymbol{\theta}_0)(\hat{\boldsymbol{\theta}}-\boldsymbol{\theta}_0),
\end{align*}\]</span> where <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span> is the maximum
likelihood estimate under the alternative and <span class="math inline">\(\boldsymbol{\theta}_0\)</span> is the null value
of the parameter vector. The statistics <span class="math inline">\(w,
w_{\mathsf{score}}, w_{\mathsf{wald}}\)</span> are all first order
equivalent and asymptotically follow a <span class="math inline">\(\chi^2_p\)</span> distribution, where <span class="math inline">\(q\)</span> is the difference between <span class="math inline">\(p\)</span> and the number of parameters under the
null hypothesis. Under the conditions of the Neyman–Pearson theorem, the
likelihood ratio test is most powerful test of the lot. The score
statistic <span class="math inline">\(w_{\mathsf{score}}\)</span> only
requires calculation of the score and information under <span class="math inline">\(\mathscr{H}_0\)</span>, which can be useful in
problems where calculations under the alternative are difficult to
obtain. The Wald statistic <span class="math inline">\(w_{\mathsf{wald}}\)</span> is not
parametrization-invariant and typically has poor coverage
properties.</p>
<p>Oftentimes, we are interested in a functional of the parameter vector
<span class="math inline">\(\boldsymbol{\theta}\)</span>. The profile
likelihood <span class="math inline">\(\ell_\mathsf{p}\)</span>, a
function of <span class="math inline">\(\boldsymbol{\psi}\)</span>
alone, is obtained by maximizing the likelihood pointwise at each fixed
value <span class="math inline">\(\boldsymbol{\psi}=\boldsymbol{\psi}_0\)</span>
over the nuisance vector <span class="math inline">\(\boldsymbol{\lambda}_{\psi_0}\)</span>, <span class="math display">\[\begin{align*}
   \ell_\mathsf{p}(\boldsymbol{\psi})=\max_{\boldsymbol{\lambda}}\ell(\boldsymbol{\psi},
\boldsymbol{\lambda})=\ell(\boldsymbol{\psi},
\hat{\boldsymbol{\lambda}}_{\boldsymbol{\psi}}).
\end{align*}\]</span> We denote the restricted maximum likelihood
estimator <span class="math inline">\(\hat{\boldsymbol{\theta}}_\psi=
(\psi, \hat{\lambda}_{\psi})\)</span>.</p>
<p>We can define score and information in the usual fashion: for
example, the observed profile information function is <span class="math display">\[j_\mathsf{p}(\boldsymbol{\psi})
=-\frac{\partial \ell_\mathsf{p}(\boldsymbol{\psi})}{\partial
\boldsymbol{\psi}\partial \boldsymbol{\psi}^\top}
= \left\{j^{\boldsymbol{\psi\psi}}(\boldsymbol{\psi},
\hat{\boldsymbol{\lambda}}_{\boldsymbol{\psi}})\right\}^{-1}.
\]</span> The profile likelihood is not a genuine likelihood in the
sense that it is not based on the density of a random variable.</p>
<p>We can turn tests and their asymptotic distribution into confidence
intervals. For the hypothesis <span class="math inline">\(\psi =
\psi_0\)</span>, a <span class="math inline">\((1-\alpha)\)</span>
confidence interval based on the profile likelihood ratio test is <span class="math inline">\(\{ \psi: 2\{\ell(\hat{\theta}) -
\ell(\hat{\theta}_{\psi})\} \leq \chi^2_1(0.95)\}\)</span>.</p>
<p>Two typical questions in extreme values are: given the intensity of
an extreme event, what is its recurrence period? and what is a typical
worst-case scenario over a given period of time? For the latter, suppose
for simplicity that the daily observations are blocked into years, so
that inference is based on <span class="math inline">\(N\)</span> points
for the <span class="math inline">\(N\)</span> years during which the
data were recorded. The <em>return level</em> is a quantile of the
underlying distribution corresponding to an event of probability <span class="math inline">\(p=1-1/T\)</span> for an annual maximum, which is
interpreted as ``the level exceeded by an annual maximum on average
every <span class="math inline">\(T\)</span> years’’. If observations
are independent and identically distributed, then we can approximate the
probability that a return level is exceeded <span class="math inline">\(l\)</span> times over a <span class="math inline">\(T\)</span> year period using a binomial
distribution with probability of success <span class="math inline">\(1-1/T\)</span> and <span class="math inline">\(T\)</span> trials. For <span class="math inline">\(T\)</span> large, the return level is exceeded
<span class="math inline">\(l=0, 1, 2, 3, 4\)</span> times within any
<span class="math inline">\(T\)</span>-years period with approximate
probabilities 36.8%, 36.8%, 18.4%, 6.1% and 1.5%. The probability that
the maximum observation over <span class="math inline">\(T\)</span>
years is exceeded with a given probability is readily obtained from the
distribution of the <span class="math inline">\(T\)</span>-year maximum,
leading <span class="citation">(Cox, Isham, and Northrop 2002,
3(b))</span> to advocate its use over return levels, among other
quantities of interest such as the number of times a threshold <span class="math inline">\(u\)</span> will be exceeded in <span class="math inline">\(T\)</span> years or the average number of years
before a threshold <span class="math inline">\(u\)</span> is
exceeded.</p>
<p><strong>Quantiles, mean and return levels of <span class="math inline">\(T\)</span>-maxima</strong>: consider the
distribution <span class="math inline">\(H(x) = G^T(x)\)</span> of the
maximum of <span class="math inline">\(T\)</span> independent and
identically distributed generalized extreme value variates with
parameters <span class="math inline">\((\mu, \sigma, \xi)\)</span> and
distribution function <span class="math inline">\(G\)</span>. By
max-stability, the parameters of <span class="math inline">\(H(x)\)</span> are <span class="math inline">\(\mu_T=\mu-\sigma(1-T^\xi)/\xi\)</span> and <span class="math inline">\(\sigma_T=\sigma T^\xi\)</span> when <span class="math inline">\(\xi \neq 0\)</span>. We denote the expectation of
the <span class="math inline">\(T\)</span>-observation maximum by <span class="math inline">\(\mathfrak{e}_T\)</span>, the <span class="math inline">\(p\)</span> quantile of the <span class="math inline">\(T\)</span>-observation maximum by <span class="math inline">\(\mathfrak{q}_p = H^{-1}(p)\)</span> and the
associated return level by <span class="math inline">\(z_{1/T} =
G^{-1}(1-1/T)\)</span>. Then, any of these three quantities can be
written as <span class="math display">\[\begin{align*}
\begin{cases}
\mu-\frac{\sigma}{\xi}\left\{1-\kappa_{\xi}\right\}, &amp;  \xi &lt;1,
\xi \neq 0, \\
\mu+\sigma\kappa_0, &amp;  \xi =0,
  \end{cases}
\end{align*}\]</span> where <span class="math inline">\(\kappa_{\xi}=T^\xi\Gamma(1-\xi)\)</span> for <span class="math inline">\(\mathfrak{e}_T\)</span>, <span class="math inline">\(\kappa_{\xi}=T^\xi\log(1/p)^{-\xi}\)</span> for
<span class="math inline">\(\mathfrak{q}_p\)</span> and <span class="math inline">\(\kappa_{\xi}=\left\{-\log\left(1-{1}/{T}\right)\right\}^{-\xi}\)</span>
for <span class="math inline">\(z_{1/T}\)</span>. In the Gumbel case, we
have <span class="math inline">\(\kappa_0=\log(T)+\gamma_{e}\)</span>
for <span class="math inline">\(\mathfrak{e}_T\)</span>, <span class="math inline">\(\kappa_0=\log(T)-\log\{-\log(p)\}\)</span> for
<span class="math inline">\(\mathfrak{q}_p\)</span> and <span class="math inline">\(\kappa_0=-\log\{-\log(1-1/T)\}\)</span> for <span class="math inline">\(z_{1/T}\)</span>.</p>
</div>
<div class="section level2">
<h2 id="numerical-example">Numerical example<a class="anchor" aria-label="anchor" href="#numerical-example"></a>
</h2>
<p>This example illustrates some of the functions used in
peaks-over-threshold analysis based on fitting a generalized Pareto
distribution to threshold exceedances. We use the Venezuelian rainfall
data, a time series of daily rainfall precipitations at Maiquetia
airport in Venezuela, for the purpose of illustration.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lbelzile.github.io/mev/" class="external-link">mev</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"maiquetia"</span>, package <span class="op">=</span> <span class="st">"mev"</span><span class="op">)</span>
<span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1961-01-01"</span><span class="op">)</span>, 
                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1999-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="co"># Keep non-zero rainfall, exclude 1999 observations</span>
<span class="va">nzrain</span> <span class="op">&lt;-</span> <span class="va">maiquetia</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">day</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">99</span> <span class="op">&amp;</span> <span class="va">maiquetia</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>
<span class="va">gpdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.gpd.html">fit.gpd</a></span><span class="op">(</span><span class="va">nzrain</span>, threshold <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gpdf</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Method: Grimshaw </span>
<span class="co">## Log-likelihood: -832.629 </span>
<span class="co">## </span>
<span class="co">## Threshold: 20 </span>
<span class="co">## Number Above: 216 </span>
<span class="co">## Proportion Above: 0.0604 </span>
<span class="co">## </span>
<span class="co">## Estimates</span>
<span class="co">##   scale    shape  </span>
<span class="co">## 15.5800   0.1088  </span>
<span class="co">## </span>
<span class="co">## Standard Errors</span>
<span class="co">##   scale    shape  </span>
<span class="co">## 1.60673  0.07785  </span>
<span class="co">## </span>
<span class="co">## Optimization Information</span>
<span class="co">##   Convergence: successful</span></code></pre>
<p>We will ignore temporal dependence and stationarity, but these should
be considered. The first step in our analysis is to choose a threshold.
For the time being, we set the latter to 20 and consider threshold
selection in the next section.</p>
<p>The default optimization routine for the generalized Pareto
distribution is Grimshaw’s method, which profiles out the likelihood.
The method has theoretical convergence guaranteesfor convergence.
Because of non-regularity, the maximum likelihood estimator for <span class="math inline">\(\xi &lt; -1\)</span> does not solve the score
equation and leads to infinite log-likelihood, hence the maximum
returned lies on the boundary of the parameter space. The standard
errors are based on the inverse observed information matrix and provided
only if <span class="math inline">\(\xi&gt;-1/2\)</span>. We can verify
that our maximum likelihood estimate is indeed a maximum by checking if
it solves the score equation if <span class="math inline">\(\hat{\xi}&gt;-1\)</span>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/gpd.score.html">gpd.score</a></span><span class="op">(</span><span class="va">gpdf</span><span class="op">$</span><span class="va">estimate</span>, dat <span class="op">=</span> <span class="va">gpdf</span><span class="op">$</span><span class="va">exceedances</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">1e-5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>If the sample is small, maximum likelihood estimators are biased for
the generalized Pareto distribution (the shape parameter is negatively
biased, regardless of the true value for <span class="math inline">\(\xi\)</span>). Bias correction methods includes
the modified score of Firth, but the default method is the implicit
correction (<code>subtract</code>), which solves the implicit equation
<span class="math display">\[\begin{align}
   \boldsymbol{\tilde{\theta}}=\hat{\boldsymbol{\theta}}-\boldsymbol{b}(\tilde{\boldsymbol{\theta}}).
\label{eq:implbias}
\end{align}\]</span> The point estimate <span class="math inline">\(\boldsymbol{\tilde{\theta}}\)</span> is obtained
numerically as the root of this nonlinear system of equations. In the
present case, the sample size is large and hence the first-order
correction, derived through asymptotic arguments from the generalized
Pareto distribution likelihood, is small. Note that the bias correction
requires <span class="math inline">\(\xi &gt; -1/3\)</span>, since it is
based on third-order cumulants of the distribution.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gpdbcor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gpd.bcor.html">gpd.bcor</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">gpdf</span><span class="op">$</span><span class="va">exceedances</span>, par <span class="op">=</span> <span class="va">gpdf</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>
<span class="co">#print the differences between MLE and bias-corrected estimates</span>
<span class="va">gpdf</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">gpdbcor</span></code></pre></div>
<pre><code><span class="co">##      scale      shape </span>
<span class="co">##  0.1915284 -0.0118876</span></code></pre>
<p>The package includes some default diagnostic plots
(probability-probability plots and quantile-quantile plots), which
include approximate confidence intervals based on order statistics. We
can also get profile likelihood and profile-based confidence intervals
for most quantities of interest (parameters of the generalized Pareto
distribution, excepted shortfall, return levels, <span class="math inline">\(N\)</span>-observation maxima mean and
quantiles).</p>
</div>
<div class="section level2">
<h2 id="exercice">Exercice<a class="anchor" aria-label="anchor" href="#exercice"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Simulate 200 observations from the <span class="math inline">\(r\)</span>-largest likelihood using
<code>rrlarg</code> with shape parameter <span class="math inline">\(\xi=-0.2\)</span> and <span class="math inline">\(r=5\)</span>.</li>
<li>Test the hypothesis <span class="math inline">\(\mathscr{H}_0: \xi =
\xi_0\)</span> using a score test and derive a 90% confidence interval
for <span class="math inline">\(\xi\)</span>. You can obtain the maximum
likelihood estimator by calling <code>fit.rlarg</code> and the score and
information matrix are implemented under <code>rlarg.score</code> and
<code>rlarg.infomat</code>. Recall that the score statistic <span class="math inline">\(w_{\mathsf{score}} \equiv
U(\hat{\boldsymbol{\theta}}_{\xi_0})^\top
i^{-1}(\hat{\boldsymbol{\theta}}_{\xi_0})U(
\hat{\boldsymbol{\theta}}_{\xi_0}) \sim \chi^2_1.\)</span>
</li>
</ol>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Coles:2001" class="csl-entry">
Coles, Stuart. 2001. <em>An <span>I</span>ntroduction to
<span>S</span>tatistical <span>M</span>odeling of <span>E</span>xtreme
<span>V</span>alues</em>. London: Springer–Verlag.
</div>
<div id="ref-Cox:2002" class="csl-entry">
Cox, D. R., V. S. Isham, and P. J. Northrop. 2002. <span>“Floods: Some
Probabilistic and Statistical Approaches.”</span> <em>Philosophical
Transactions of the Royal Society of London A: Mathematical, Physical
and Engineering Sciences</em> 360 (1796): 1389–1408. <a href="https://doi.org/10.1098/rsta.2002.1006" class="external-link">https://doi.org/10.1098/rsta.2002.1006</a>.
</div>
<div id="ref-Dupuis:1999" class="csl-entry">
Dupuis, D. J. 1999. <span>“Exceedances over High Thresholds: A Guide to
Threshold Selection.”</span> <em>Extremes</em> 1 (3): 251–61. <a href="https://doi.org/10.1023/A:1009914915709" class="external-link">https://doi.org/10.1023/A:1009914915709</a>.
</div>
<div id="ref-Grimshaw:1993" class="csl-entry">
Grimshaw, Scott D. 1993. <span>“Computing Maximum Likelihood Estimates
for the Generalized <span>P</span>areto Distribution.”</span>
<em>Technometrics</em> 35 (2): 185–91. <a href="https://doi.org/10.1080/00401706.1993.10485040" class="external-link">https://doi.org/10.1080/00401706.1993.10485040</a>.
</div>
<div id="ref-Sharkey:2017" class="csl-entry">
Sharkey, Paul, and Jonathan A. Tawn. 2017. <span>“A <span>P</span>oisson
Process Reparameterisation for <span>B</span>ayesian Inference for
Extremes.”</span> <em>Extremes</em> 20 (2): 239–63. <a href="https://doi.org/10.1007/s10687-016-0280-2" class="external-link">https://doi.org/10.1007/s10687-016-0280-2</a>.
</div>
<div id="ref-Smith:1985" class="csl-entry">
Smith, Richard L. 1985. <span>“Maximum Likelihood Estimation in a Class
of Nonregular Cases.”</span> <em>Biometrika</em> 72 (1): 67–90. <a href="https://doi.org/10.1093/biomet/72.1.67" class="external-link">https://doi.org/10.1093/biomet/72.1.67</a>.
</div>
<div id="ref-Zhang:2010" class="csl-entry">
Zhang, Jin. 2010. <span>“Improving on Estimation for the Generalized
Pareto Distribution.”</span> <em>Technometrics</em> 52 (3): 335–39. <a href="https://doi.org/10.1198/TECH.2010.09206" class="external-link">https://doi.org/10.1198/TECH.2010.09206</a>.
</div>
<div id="ref-Zhang.Stephens:2009" class="csl-entry">
Zhang, Jin, and Michael A. Stephens. 2009. <span>“A New and Efficient
Estimation Method for the Generalized <span>P</span>areto
Distribution.”</span> <em>Technometrics</em> 51 (3): 316–25. <a href="https://doi.org/10.1198/tech.2009.08017" class="external-link">https://doi.org/10.1198/tech.2009.08017</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leo Belzile, Jennifer L. Wadsworth, Paul J. Northrop,
Scott D. Grimshaw, Raphael Huser.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
