<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mev">
<title>Threshold selection tools • mev</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Threshold selection tools">
<meta property="og:description" content="mev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mev</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.13.10000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-univariate.html">Likelihood based inference for univariate extremes</a>
    <a class="dropdown-item" href="../articles/02-threshold.html">Threshold selection tools</a>
    <a class="dropdown-item" href="../articles/03-penultimate.html">Penultimate approximations</a>
    <a class="dropdown-item" href="../articles/04-simulation.html">Simulation of multivariate extreme value distributions and processes</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lbelzile/mev/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Threshold selection tools</h1>
                        <h4 data-toc-skip class="author">Léo
Belzile</h4>
            
            <h4 data-toc-skip class="date">2022-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lbelzile/mev/blob/HEAD/vignettes/02-threshold.Rmd" class="external-link"><code>vignettes/02-threshold.Rmd</code></a></small>
      <div class="d-none name"><code>02-threshold.Rmd</code></div>
    </div>

    
    
<p>The generalized Pareto (GP) distribution with scale <span class="math inline">\(\sigma \in \mathbb{R}_{+}\)</span> and shape <span class="math inline">\(\xi \in \mathbb{R}\)</span> is <span class="math display">\[\begin{align*}
  G(x)  = \begin{cases}
1-\left\{1+\xi \left(\frac{x}{\sigma}\right)\right\}_{+}^{-1/\xi},
&amp;  \xi \neq 0,
\\ 1-\exp \left(-{x}{\sigma}\right),&amp;  \xi = 0.
\end{cases}
\end{align*}\]</span> The range of the generalized Pareto distribution
is <span class="math inline">\([0, -\sigma/\xi)\)</span> if <span class="math inline">\(\xi &lt; 0\)</span> and <span class="math inline">\(\mathbb{R}_{+}\)</span> otherwise.</p>
<p>Why is the generalized Pareto distribution so central to
peaks-over-threshold analysis? The conditional distribution of
exceedances over a threshold <span class="math inline">\(u &lt;
x^*\)</span> converges to a generalized Pareto distribution as <span class="math inline">\(u\)</span> converges to the endpoint of the
distribution, <span class="math display">\[\begin{align*}
\lim_{u \to x^*} \frac{1-F(xa_u+u)}{1-F(u)} = 1-H(x),
\end{align*}\]</span> where <span class="math inline">\(H(x)\)</span> is
the distribution function of <span class="math inline">\(\mathsf{GP}(1,
\xi)\)</span>.</p>
<p>If <span class="math inline">\(X \sim \mathsf{GP}(\sigma,
\xi)\)</span>, straightforward calculations show that <span class="math inline">\(X-u \mid X&gt;u \sim \mathsf{GP}(\sigma + \xi u,
\xi)\)</span> for any <span class="math inline">\(u \in
\mathbb{R}\)</span> such that <span class="math inline">\(\sigma+\xi
u&gt;0\)</span>, meaning that conditional exceedances above a threshold
<span class="math inline">\(u\)</span> also follow a generalized Pareto
distribution. This property is termed threshold-stability.</p>
<p>The limiting distribution of threshold exceedances is generalized
Pareto as <span class="math inline">\(u \to x^*\)</span> but, in
practice, we must choose a finite threshold in order to have enough
exceedances to draw inference. Since the scaling constant <span class="math inline">\(a_u\)</span> is unknown, we have <span class="math inline">\(X \mid X &gt; u \stackrel{\cdot}{\sim}
\mathsf{GP}(\sigma_u, \xi)\)</span>. The term <span class="math inline">\(1-F(u)\)</span> in the denominator is the fraction
of points exceeding the threshold, which has a binomial
distribution.</p>
<p>Threshold selection is subtle and it is common to select a high
percentile of the data, say the 95% value, as the threshold, even if
this is asymptotically incorrect, as in this case <span class="math inline">\(k/n \nrightarrow 0\)</span> as <span class="math inline">\(n \to \infty\)</span>. Most approaches for
threshold selection rely on properties of the generalized Pareto
distribution (moments, threshold-stability) to determine a region within
which the asymptotic distribution fits the data well and the parameter
estimates are stable.</p>
<p>Below, we focus on recent graphical selection tools for likelihood
based inference; mixture models are reviewed in <span class="citation">Scarrott and MacDonald (2012)</span> and are available
in the package <code>evmix</code>.</p>
<div class="section level2">
<h2 id="threshold-stability-plots">Threshold stability plots<a class="anchor" aria-label="anchor" href="#threshold-stability-plots"></a>
</h2>
<p>Consider a sequence of ordered candidate thresholds <span class="math inline">\(u_1 &lt; \cdots &lt; u_k\)</span>; one of the most
widely used tools for threshold selection is the threshold-stability
plots of <span class="citation">Davison and Smith (1990)</span>. These
show the point estimates of the shape <span class="math inline">\(\xi\)</span> and the modified scale <span class="math inline">\(\sigma_{u_i}-\xi u_i\)</span>, which should be
constant for any threshold <span class="math inline">\(u_{j}
&gt;u_i\)</span> assuming that the generalized Pareto above <span class="math inline">\(u_i\)</span> holds exactly. In addition to the
point estimates, the asymptotic pointwise 95% Wald confidence intervals
are displayed; the standard errors are obtained from the observed
information matrix. While these are displayed by many packages, notably
<code>extRemes</code>, <code>ismev</code> and <code>evd</code> ,
<code>mev</code> allows you to use profile likelihood based confidence
intervals, which typically offer better coverage and capture some of the
asymmetry of the distribution. The <code>mev</code> package functions
for producing threshold stability plots are <code>tstab.gpd</code> and
<code>tstab.pp</code> for respectively the generalized Pareto and
Poisson process likelihoods.</p>
<p>Parameter stability plots can be difficult to interpret because the
confidence intervals are pointwise rather than simultaneous (each fit
likewise uses an overlapping portion of the data). The plots also ignore
changes in the estimated parameters due to the penultimate
approximation.</p>
</div>
<div class="section level2">
<h2 id="wadsworths-diagnostics-white-noise-process-and-simultaneous-threshold-stability-plots">Wadsworth’s diagnostics: white noise process and simultaneous
threshold stability plots<a class="anchor" aria-label="anchor" href="#wadsworths-diagnostics-white-noise-process-and-simultaneous-threshold-stability-plots"></a>
</h2>
<p>The problem with the threshold stability plots lies in the point-wise
nature of the estimate. Assuming a superposition of <span class="math inline">\(k\)</span> Poisson processes, <span class="citation">Wadsworth (2016)</span> derives the limiting
distribution of the maximum likelihood estimators from the Poisson
process for overlapping windows as the number of windows <span class="math inline">\(k \to \infty\)</span> and <span class="math inline">\(n_k \to \infty\)</span>. The joint asymptotic
Gaussian distribution allows <span class="citation">Wadsworth
(2016)</span> to propose two additional diagnostics: a white noise
sequence of differences in estimates of the shape, standardized to have
unit variance. The variables <span class="math inline">\(\xi^*_i=(\hat{\xi}_{u_{i+1}}-\hat{\xi}_{u_i})/\{(I^{-1}_{u_{i+1}}-I^{-1}_{u_{i}})_{\xi,\xi}^{1/2}\}\)</span>,
where <span class="math inline">\(I_{u_{i}}\)</span> is the Fisher
information of the Poisson process likelihood for exceedances above
<span class="math inline">\(u_i\)</span>, should form a white-noise
sequence of independent variables centered around the origin; systematic
deviations are indicative of inadequacy. To formally test the
hypothesis, a likelihood ratio test can be used assuming a simple
alternative, namely a single change point at threshold <span class="math inline">\(u_j\)</span>. The null hypothesis is <span class="math inline">\(\mathrm{H}_0: \xi_i^* \stackrel{\cdot}{\sim}
\mathsf{No}(0,1)\)</span> for <span class="math inline">\(i=1, \ldots,
k-1\)</span> against the alternative <span class="math inline">\(\mathrm{H}_a: \xi^*_i \sim \mathsf{No}(\beta,
\sigma) (i=1, \ldots, j-1)\)</span> and <span class="math inline">\(\xi^*_i \sim \mathsf{No}(0,1)\)</span> for <span class="math inline">\(j, \ldots, k-1\)</span>. This alternative is
motivated by results on model misspecification <span class="citation">(White 1982)</span>, which suggest that the asymptotic
distribution may still be Gaussian, but with a different mean and
variance. This can be used to automate threshold selection, by picking
the smallest threshold for which the <span class="math inline">\(P\)</span>-value is above the level <span class="math inline">\(\alpha\)</span>. The function <code>W.diag</code>
returns diagnostics plots (for the likelihood ratio statistic path, the
white noise process and threshold stability along with asymptotic
simultaneous confidence intervals) for non-homogeneous Poisson process
model and for the bivariate exponential and the over a sequence of
thresholds, specified using <code>q1</code>, <code>q2</code> and
<code>k</code>. The argument <code>M</code> is a tuning parameter that
can be chosen in a way such that the parameters of the non-homogeneous
Poisson process likelihood coincide with those of the generalized
extreme value distribution for blocks of size <span class="math inline">\(m\)</span>; see <span class="citation">Coles
(2001)</span> to this effect.</p>
<p>A main criticism of the proposals of <span class="citation">Wadsworth
(2016)</span> is their lack of robustness. For the asymptotic result to
be approximately valid, the number of thresholds must be large, which
implicitly requires large samples for each superposed point process.
Moreover, the estimated difference in Fisher information matrices often
fails to be positive definite in practice. The procedure is highly
sensitive to the choice of <span class="math inline">\(k\)</span>.
Changing the set of thresholds <span class="math inline">\(\boldsymbol{u}\)</span> under consideration leads
to potentially completely different parameter estimates being chosen by
the automated procedure.</p>
</div>
<div class="section level2">
<h2 id="changepoint-tests-based-on-penultimate-approximation">Changepoint tests based on penultimate approximation<a class="anchor" aria-label="anchor" href="#changepoint-tests-based-on-penultimate-approximation"></a>
</h2>
<p>Let <span class="math inline">\(F(x)\)</span> denote a
thrice-differentiable distribution function with endpoint <span class="math inline">\(x^*\)</span> and density <span class="math inline">\(f(x)\)</span>. Define the reciprocal hazard
function <span class="math inline">\(r(x) = \{1-F(x)\}/f(x)\)</span>.
The existence of the limit <span class="math inline">\(\xi_{\infty} =
\lim_{n \to \infty} s'\{b_n\}\)</span> is necessary and sufficient
for convergence to an extreme value distribution and <span class="citation">Smith (1987)</span> shows that there exists <span class="math inline">\(y\)</span> such that <span class="math display">\[\begin{align*}
\frac{1-F\{u+xr(u)\}}{1-F(u)} =
\left\{1+xr'(y)\right\}_{+}^{-1/r'(y)}, \qquad u &lt; y &lt;
u+xr(u),
\end{align*}\]</span> unless <span class="math inline">\(r'(x)\)</span> is constant. The penultimate
shape parameter for the generalized Pareto distribution is <span class="math inline">\(r'(u)\)</span>, but the true shape parameter
lies between <span class="math inline">\(r'(u)\)</span> and <span class="math inline">\(\xi_{\infty}\)</span>.</p>
<p>When we fit the limiting parametric models to finite samples, maximum
likelihood estimates of the shape parameter will be closer to their
penultimate counterparts than to the limiting value and we can expect
them to vary as we increase the threshold.</p>
<p><span class="citation">Northrop and Coleman (2014)</span> adapt the
idea of <span class="citation">Wadsworth and Tawn (2012)</span> and fit
a generalized Pareto model with piecewise constant shape to <span class="math inline">\(k\)</span> different thresholds; continuity
constraints at the thresholds impose <span class="math inline">\(k-1\)</span> restrictions on scale parameters, so
the model only has <span class="math inline">\(k+1\)</span> parameters.
A score test can be used to test the hypothesis of equal shape and it
only requires evaluation of the model under the null hypothesis that a
generalized Pareto distribution is valid above all thresholds. A
diagnostic plot is obtained by plotting <span class="math inline">\(P\)</span>-values against threshold. One can then
choose to take, e.g., (a) the lowest threshold at which the <span class="math inline">\(P\)</span>-value is non-significant, or (b) the
lowest threshold at which the <span class="math inline">\(P\)</span>-values for all higher thresholds are
non-significant: under the null hypothesis, there is an <span class="math inline">\(\alpha\%\)</span> probability of rejection at any
given threshold. The function <code>NC.diag</code> computes the <span class="math inline">\(P\)</span>-value of the score test as a function
of the threshold.</p>
</div>
<div class="section level2">
<h2 id="extended-generalized-pareto">Extended generalized Pareto<a class="anchor" aria-label="anchor" href="#extended-generalized-pareto"></a>
</h2>
<p><span class="citation">Papastathopoulos and Tawn (2013)</span>
propose three extended generalized Pareto distributions: for example,
the third extended generalized Pareto model has distribution function
<span class="math inline">\(\{1-(1+\xi
x/\sigma)^{-1/\xi}_{+}\}^{\kappa}\)</span> for <span class="math inline">\(x &gt;0\)</span> and <span class="math inline">\(\kappa &gt; 0\)</span>. Each family reduces to the
generalized Pareto when the additional parameter <span class="math inline">\(\kappa=1\)</span> and share the same tail index
<span class="math inline">\(\xi\)</span>, the extended generalized
Pareto provide more flexibility for modelling departures from the
limiting form. Standard parameter stability plots can be used to find a
region in which <span class="math inline">\(\kappa \approx 1\)</span>
and the shape parameter stabilizes. The additional parameter gives
flexibility for modelling departures from the limiting distribution and
the hope is one can fit to exceedances over lower threshold and increase
the number of points to which the distribution is fitted. The stability
plots, obtained through <code>tstab.egp</code>, suffer from the same
caveats as classical diagnostics.</p>
</div>
<div class="section level2">
<h2 id="robust-selection">Robust selection<a class="anchor" aria-label="anchor" href="#robust-selection"></a>
</h2>
<p>The extreme value distributions have unbounded influence functions
and outliers can strongly affect the estimate of the shape. <span class="citation">Dupuis (1999)</span> proposes an optimal <span class="math inline">\(B\)</span>-robust estimator of the generalized
Pareto parameters. Points that are outlying or for which the fit is poor
are downweighted; if the weights for the largest observations are very
low, this suggests that the threshold is too low. While there is no
guarantee that observations that were simulated from a generalized
Pareto distributed would not be downweighted, systematic downweighting
of the largest exceedances may be indicative of poor fit.</p>
<p>We are now ready to go back to the Maiquetia data and try to select a
reasonable threshold. To this effect, we select a sequence of candidate
thresholds and run the procedures described above.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lbelzile/mev/" class="external-link">mev</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">maiquetia</span>, package <span class="op">=</span> <span class="st">"mev"</span><span class="op">)</span>
<span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1961-01-01"</span><span class="op">)</span>, 
                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1999-12-31"</span><span class="op">)</span>, 
                by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="va">nzrain</span> <span class="op">&lt;-</span> <span class="va">maiquetia</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">day</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1999</span> <span class="op">&amp;</span> <span class="va">maiquetia</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>
<span class="co"># Keep non-zero rainfall, exclude 1999 observations</span>
<span class="va">nzrain</span> <span class="op">&lt;-</span> <span class="va">maiquetia</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">day</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">99</span> <span class="op">&amp;</span> <span class="va">maiquetia</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>
<span class="va">thcan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">nzrain</span>, 
                  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.99</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/tstab.gpd.html">tstab.gpd</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">nzrain</span>, 
          thresh <span class="op">=</span> <span class="va">thcan</span>, 
          method <span class="op">=</span> <span class="st">"profile"</span><span class="op">)</span></code></pre></div>
<p><img src="02-threshold_files/figure-html/tstabplots-1.png" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fit.egp.html">tstab.egp</a></span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">nzrain</span>, 
          thresh <span class="op">=</span> <span class="va">thcan</span>, 
          model <span class="op">=</span> <span class="st">"egp2"</span><span class="op">)</span></code></pre></div>
<p><img src="02-threshold_files/figure-html/tstagegp-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>What do you notice on the parameter stability plots?</p>
<p>We can plot simultaneous parameter stability plots for the shape, as
well as the white-noise sequence. The <code>W.diag</code> function,
which implements the tests of <span class="citation">Wadsworth
(2016)</span>, returns the white noise process and calculates by
simulation the null distribution, selecting the lowest threshold at
which the hypothesis of changepoint is not rejected for all higher
thresholds. For the Maiquetia rainfall, a threshold around 15.15mm is
returned.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fWdiag</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/W.diag.html">W.diag</a></span><span class="op">(</span>
    xdat <span class="op">=</span> <span class="va">nzrain</span>,
    model <span class="op">=</span> <span class="st">"nhpp"</span>,
    u <span class="op">=</span> <span class="va">thcan</span>,
    plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WN"</span>, <span class="st">"PS"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p><img src="02-threshold_files/figure-html/Wdiag-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>Another option is the <span class="citation">Northrop and Coleman
(2014)</span> penultimate test, which considers a sequence of threshold
and tests whether a single shape fits the data against the alternative
where the shape parameter differs at each candidate threshold following
a step function. The <code>NC.diag</code> function plots the <span class="math inline">\(p\)</span>-value path against the candidate
thresholds; the top axis also displays the number of threshold
exceedances. The extended generalized Pareto distribution can also be
used to produce threshold stability plot with 95% confidence intervals.
The parameter <span class="math inline">\(\kappa=1\)</span> if the model
is generalized Pareto. Although there are three potential families, the
family <code>egp2</code> exhibits the fastest converence for</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fNCdiag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NC.diag.html">NC.diag</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nzrain</span>, u <span class="op">=</span> <span class="va">thcan</span><span class="op">)</span></code></pre></div>
<p><img src="02-threshold_files/figure-html/NCdiag-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="your-turn">Your turn<a class="anchor" aria-label="anchor" href="#your-turn"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Try using the threshold diagnostic tests on the <code>nidd</code>
river flow data. Which threshold would you choose based on the
conclusions of the test? Repeat the analysis on your favorite
dataset.</li>
<li>Compare the inference obtained by using the different threshold (by
comparing, for example, return levels or quantiles of a distribution of
interest). Are your results sensitive to the choice of threshold?</li>
</ol>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Coles:2001" class="csl-entry">
Coles, Stuart. 2001. <em>An <span>I</span>ntroduction to
<span>S</span>tatistical <span>M</span>odeling of <span>E</span>xtreme
<span>V</span>alues</em>. London: Springer–Verlag.
</div>
<div id="ref-Davison:1990" class="csl-entry">
Davison, A. C., and R. L. Smith. 1990. <span>“Models for Exceedances
over High Thresholds (with Discussion).”</span> <em>Journal of the Royal
Statistical Society. Series B. (Methodological)</em> 52 (3): 393–442. <a href="http://www.jstor.org/stable/2345667" class="external-link">http://www.jstor.org/stable/2345667</a>.
</div>
<div id="ref-Dupuis:1999" class="csl-entry">
Dupuis, D. J. 1999. <span>“Exceedances over High Thresholds: A Guide to
Threshold Selection.”</span> <em>Extremes</em> 1 (3): 251–61. <a href="https://doi.org/10.1023/A:1009914915709" class="external-link">https://doi.org/10.1023/A:1009914915709</a>.
</div>
<div id="ref-Northrop:2014" class="csl-entry">
Northrop, Paul J., and Claire L. Coleman. 2014. <span>“Improved
Threshold Diagnostic Plots for Extreme Value Analyses.”</span>
<em>Extremes</em> 17 (2): 289–303. <a href="https://doi.org/10.1007/s10687-014-0183-z" class="external-link">https://doi.org/10.1007/s10687-014-0183-z</a>.
</div>
<div id="ref-Papastathopoulos:2013" class="csl-entry">
Papastathopoulos, Ioannis, and Jonathan A. Tawn. 2013. <span>“Extended
Generalised <span>P</span>areto Models for Tail Estimation.”</span>
<em>Journal of Statistical Planning and Inference</em> 143 (1): 131–43.
https://doi.org/<a href="http://dx.doi.org/10.1016/j.jspi.2012.07.001" class="external-link">http://dx.doi.org/10.1016/j.jspi.2012.07.001</a>.
</div>
<div id="ref-Scarrott:2012" class="csl-entry">
Scarrott, Carl, and Anna MacDonald. 2012. <span>“A Review of
Extreme-Value Threshold Estimation and Uncertainty
Quantification.”</span> <em>REVSTAT – Statistical Journal</em> 10 (1):
33–60. <a href="https://www.ine.pt/revstat/pdf/rs120102.pdf" class="external-link">https://www.ine.pt/revstat/pdf/rs120102.pdf</a>.
</div>
<div id="ref-Smith:1987" class="csl-entry">
Smith, Richard L. 1987. <span>“Approximations in Extreme Value
Theory.”</span> Edited by University of North Carolina Chapel Hill
Center for Stochastic Processes.
</div>
<div id="ref-Wadsworth:2016" class="csl-entry">
Wadsworth, J. L. 2016. <span>“Exploiting Structure of Maximum Likelihood
Estimators for Extreme Value Threshold Selection.”</span>
<em>Technometrics</em> 58 (1): 116–26. <a href="https://doi.org/10.1080/00401706.2014.998345" class="external-link">https://doi.org/10.1080/00401706.2014.998345</a>.
</div>
<div id="ref-Wadsworth:2012" class="csl-entry">
Wadsworth, J. L., and J. A. Tawn. 2012. <span>“Likelihood-Based
Procedures for Threshold Diagnostics and Uncertainty in Extreme Value
Modelling.”</span> <em>Journal of the Royal Statistical Society: Series
B (Statistical Methodology)</em> 74 (3): 543–67. <a href="https://doi.org/10.1111/j.1467-9868.2011.01017.x" class="external-link">https://doi.org/10.1111/j.1467-9868.2011.01017.x</a>.
</div>
<div id="ref-White:1982" class="csl-entry">
White, Halbert. 1982. <span>“Maximum Likelihood Estimation of
Misspecified Models.”</span> <em>Econometrica</em> 50 (1): 1–25. <a href="http://www.jstor.org/stable/1912526" class="external-link">http://www.jstor.org/stable/1912526</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leo Belzile, Jennifer L. Wadsworth, Paul J. Northrop,
Scott D. Grimshaw, Raphael Huser.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
